<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="CodeFuse aims to develop Code Large Language Models (Code LLMs) to support and enhance full-lifecycle AI native sotware developing, covering crucial stages such as design requirements, coding, testing, building, deployment, operations, and insight analysis.">
<meta name="author" content="codefuse-ai">

<title>MuAgent · CodeFuse-AI</title>

<link rel="canonical" href="/muagent/muagent/">









<link rel="stylesheet" href="/scss/base.css" integrity="">



<link rel="stylesheet" href="/scss/theme/default.css" integrity="">



  <link rel="preconnect" href="https://-dsn.algolia.net" crossorigin />
  
  <link rel="stylesheet" href="/scss/component/docsearch.css" integrity=""/>

<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/img/icon/favicon.ico">
<link rel="icon" href="/img/icon/icon-16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/img/icon/icon-32.png" sizes="32x32" type="image/png">
<link rel="apple-touch-icon" href="/img/icon/icon-180.png" sizes="180x180">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-xxxx"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-xxxx');
</script>


  
  

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css">
  </head>
  <body>
    <header id="site-header">
  
  <div id="site-header-brand">
    <a href="/">CodeFuse-AI</a>
  </div>

  
  <div id="site-header-controls">
    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="theme selector">
        <i class="icon icon-brightness"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        <li role="menuitem"><button class="color-scheme" data-value="light"><i class="icon icon-light-mode"></i> Light</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="dark"><i class="icon icon-dark-mode"></i> Dark &nbsp;</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="night"><i class="icon icon-night-mode"></i> Night</button></li>
      </ul>
    </div>

    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="language selector">
        <i class="icon icon-translate"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        
          
          <li role="menuitem"><a href="/muagent/muagent/">English</a></li>
          
          <li role="menuitem"><a href="/zh/muagent/muagent-%E6%A6%82%E8%A7%88/">中文</a></li>
          
        
      </ul>
    </div>
  </div>

  
  <div id="site-header-menu">
    <nav>
      <ul>
        
        
        
          
          <li><a href="/" ><i class='icon icon-home'></i>Home</a></li>
        
          
          <li><a href="/docs" ><i class='icon icon-book'></i>Overview</a></li>
        
          
          <li><a href="/muagent"  class="active"><i class='icon icon-book'></i>MuAgent</a></li>
        
          
          <li><a href="/contribution" ><i class='icon icon-book'></i>Contribution</a></li>
        
      </ul>
    </nav>
  </div>

  
  <div id="site-header-search"></div>
</header>
    
<div id="site-main-content-wrapper">
  
  
    <aside id="sidebar">
  <span class="btn-close"><i class="icon icon-close"></i></span>

  <div class="sticky"><strong class="sidebar-section">❤️ MuAgent</strong>
          
          <a class="sidebar-link " href="/muagent/muagent-overview/">
            
              MuAgent Overview
            
          </a>

        
          
          <a class="sidebar-link " href="/muagent/agent-flow/">
            
              Agent Flow
            
          </a>

        
          
          <a class="sidebar-link " href="/muagent/quick-start/">
            
              Quick Start
            
          </a>

        <strong class="sidebar-section">Modules</strong>
          
          <a class="sidebar-link " href="/muagent/connector-agent/">
            
              Agent Builder
            
          </a>

        
          
          <a class="sidebar-link " href="/muagent/connector-chain/">
            
              Chain Builder
            
          </a>

        
          
          <a class="sidebar-link " href="/muagent/connector-phase/">
            
              Phase Builder
            
          </a>

        
          
          <a class="sidebar-link " href="/muagent/connector-prompt/">
            
              Create Prompt
            
          </a>

        
          
          <a class="sidebar-link " href="/muagent/connector-memory/">
            
              Memory Builder
            
          </a>

        
          
          <a class="sidebar-link " href="/muagent/custom-examples/">
            
              Custom Examples
            
          </a>

        <strong class="sidebar-section">llm_models</strong>
          
          <a class="sidebar-link " href="/muagent/llm-model-config/">
            
              LLM Model Config
            
          </a>

        
          
          <a class="sidebar-link " href="/muagent/embedding-model-config/">
            
              Embedding Model Config
            
          </a>

        <strong class="sidebar-section">Tools</strong>
          
          <a class="sidebar-link " href="/muagent/custom-tool/">
            
              Custom tool
            
          </a>

        <strong class="sidebar-section">Retrieval</strong>
          
          <a class="sidebar-link " href="/muagent/custom-retrieval/">
            
              Custom retrieval
            
          </a>

        
  </div>
</aside>
  
  <main>
    <article id="article">
      <nav id="article-nav">
  <button id="article-nav-menu-btn"><i class="icon icon-menu"></i> On this section</button>
  
</nav>
      <header id="article-header">
  <h1>MuAgent</h1>
</header>
      <div id="article-content">
        
        
        <h1 id="introduction">Introduction</h1>
<p>To enhance the performance of large models in terms of inference accuracy, various innovative Large Language Model (LLM) playbooks have emerged in the industry. From the earliest Chain of Thought (CoT) and Thread of Thought (ToT) to Games on Tracks (GoT), these methods have continually expanded the capability boundaries of LLMs. When handling complex problems, we can select, invoke and execute tool feedback through the ReAct process, while realizing multi-round tool use and multi-step execution.</p>
<p>However, for more complex scenarios, such as the development of complex code, a single-function LLM Agent is clearly not up to the task. Therefore, the community has begun to develop combinations of multiple Agents, such as projects focused on the development field like metaGPT, GPT-Engineer, and chatDev, as well as the AutoGen project that focuses on automating the construction of Agents and Agent dialogue.</p>
<p>After an in-depth analysis of these frameworks, it has been found that most Agent frameworks are highly coupled, with poor usability and extensibility. They implement specific scenarios in preset settings, but expanding to new scenarios can be very challenging.</p>
<p>Therefore, we hope to build an extensible, easy-to-use Multi-Agent framework to support ChatBots in retrieving knowledge base information while assisting with various general tasks such as daily office work, data analysis, development, and operations.</p>
<p>This project&rsquo;s Multi-Agent framework incorporates excellent designs from multiple frameworks, such as the message pool from metaGPT and the agent selector from autogen.</p>
<div align=center>
  <img src="/images/chatbot/luban.png" alt="图片">
</div>
<h1 id="muagent-framework">MuAgent Framework</h1>
<p>In MuAgent, in addition to defining the Agent interaction link and AgentBase basic execution flow, we have also designed two basic components: Prompt Manager and Memory Manager, which are used for automated construction of Prompts and chat history management, respectively. We have built an extensible, easy-to-use Multi-Agent framework, including the following content:</p>
<ul>
<li><strong>Agent Base:</strong> Established four basic types of Agents – BaseAgent, ReactAgent, ExecutorAgent, SelectorAgent – to support basic activities in various scenarios.</li>
<li><strong>Communication:</strong> Completes the transfer of information between Agents through Message and Parse Message entities, and interacts with Memory Manager to manage memory in the Memory Pool.</li>
<li><strong>Prompt Manager:</strong> Automates the assembly of Customized Agent Prompts through Role Handler, Doc/Tool Handler, Session Handler, Customized Handler.</li>
<li><strong>Memory Manager:</strong> Supports storage management of chat history, information compression, memory retrieval, and finally storage in databases, local or vector databases through the Memory Pool.</li>
<li><strong>Component:</strong> Auxiliary ecosystem components for building Agents, including Retrieval, Tool, Action, Sandbox, etc.</li>
<li><strong>Customized Model:</strong> Supports the integration of private LLM and Embedding.</li>
</ul>
<h2 id="agent-base">Agent Base</h2>
<p>At the Agent level, we provide four basic types of Agents, with Role settings for these Agents that can meet the interactions and uses of various common scenarios. All Actions are executed by Agents.</p>
<ol>
<li>BaseAgent: Provides basic question answering, tool usage, and code execution functions, and realizes input =&gt; output according to the Prompt format.</li>
</ol>
<div align=center>
  <img src="/images/muagent/baseagent.png" alt="图片" style="width: 500px;  height:auto;">
</div>
<ol start="2">
<li>ReactAgent: Provides standard React functionality, according to questions to execute current tasks.</li>
</ol>
<div align=center>
  <img src="/images/muagent/reactagent.webp" alt="图片" style="width: 500px;  height:auto;">
</div>
<ol start="3">
<li>ExecutorAgent: Sequentially executes a list of tasks, completing related tasks according to plans arranged by the User or the previous Agent. The Agent receives a task list ([List[task]) and loops through the tasks (Feedback Agents can also be added in the middle for task re-optimization), until the task is complete.</li>
</ol>
<div align=center>
  <img src="/images/muagent/executoragent.png" alt="图片" style="width: 500px;  height:auto;">
</div>
<ol start="4">
<li>SelectorAgent: Provides the function of selecting an Agent, choosing the appropriate Agent to respond based on the question from the User or the previous Agent.</li>
</ol>
<div align=center>
  <img src="/images/muagent/selectoragent.webp" alt="图片" style="width: 500px;  height:auto;">
</div>
<h2 id="communication">Communication</h2>
<p>To enable better interaction between Agents, as well as to provide each Agent with enough information to complete their specific tasks, we have divided the Message information body into several parts, such as System Content, Info Content, LLM Content, and LLM Parsed Content, etc.</p>
<p>System Content: Used to store and manage the timing of the current LLM output, Role information, etc.
Info Content: LLM auxiliary information, such as knowledge base query information, code library retrieval information, tool information, Agent information, etc.</p>
<p>LLM Content: Directly stores and conveys information generated by the LLM.
LLM Parsed Content: Parses the LLM&rsquo;s output into a more manageable key-value data structure, making it easier to filter through LLM content.
Customized Content: Manages key-value data content generated by custom actions, used for subsequent assembly and construction of custom Prompt templates.
By defining the above message formats, we can accomplish the transfer and management of general messages. Specific assembly methods can be seen in the Prompt Manager module.</p>
<h2 id="context-manager">Context Manager</h2>
<h3 id="memory-manager">Memory Manager</h3>
<p>Mainly used for the management of chat history:</p>
<ul>
<li>Storage Management: Implements the save and load management of chat history in the database or locally, including user input, LLM output, observation output.</li>
<li>Information Compression: Summarizes key information from the chat history into a summary context, such as single text summaries, summaries from different angles, key information extraction, multi-text summaries, and serves as Prompt context.</li>
<li>Memory Retrieval: Provides basic retrieval functions, retrieving information related to questions from chat history or Summary Context to assist in Q&amp;A.</li>
<li>LLM Automatic Trigger: Future definitions of policies or the use of LLM to trigger the compression summary and retrieval functions.</li>
</ul>
<h3 id="prompt-manager">Prompt Manager</h3>
<p>Asking LLMs has become common practice, but how to coordinate the planning and usage of tools, code writing abilities among multiple large models to guide their expected outputs has become a key issue. Essentially, this involves abstracting business problems into executable Prompts, so we&rsquo;re not just designing Agents but rather engaging in framework design after a deep understanding of the current demands.</p>
<p>In actual business scenarios where LLMs are involved (excluding the SFT process), we can designate LLM to complete specific tasks and obtain expected outputs through the design of Agent Prompt content. In the process of MuAgent, the Prompt is divided into three parts: System Prompt, Context Prompt, Customized Prompt.</p>
<ul>
<li>System Prompt includes Role Name, Role Description, Task, etc.</li>
<li>Context Prompt includes Doc Context, Code Context, Tool Context, Agent Context, Session Context, etc.</li>
<li>Customized Prompt involves custom inputs and outputs, such as&hellip;
We can also ask the model to output structured texts, such as the JSON string of a tool, code\ncode_content, etc., to complete particular workflows.</li>
</ul>
<p><strong>Automatic Prompt Assemble</strong></p>
<p>After defining the structure as above, we can complete the automation assembly of Prompts in the following ways, without having to make extensive adjustments to the prompt each time:</p>
<ol>
<li>Upon defining an Agent, configure Role Name, Role Description, Task, etc., to determine what the Agent needs to do.</li>
<li>Pre-package some reusable Context Prompt general strategies, such as selectable Role&rsquo;s SessionContext, configurable Tool, Code Retrieval, Doc Retrieval, Search Retrieval, Agent to complete corresponding assemblies.</li>
<li>As the Agent&rsquo;s Prompt requires relatively personalized operations, it also supports the addition of new key-context designs within the Prompt Manager module to achieve personalized Agent Prompts.</li>
</ol>
<p><strong>Automatic Prompt Design</strong>
Able to automatically design the best prompt based on role description, task, query, etc.; to be defined&hellip;</p>
<p><strong>Multi Prompt Design</strong>
Based on the previous definition of Prompt, we know that a Prompt consists of three parts: System Prompt, Context Prompt, Customized Prompt. Any changes in the three parts may cause changes in the final output of the LLM.</p>
<p>For the same type of task, their System Prompt is the same. So, without considering the variations of Customiezd Prompt, it is possible to achieve the assembly differences of different contexts. For example, Prompt A obtains 10 rounds of chat history, while Prompt B uses 5 rounds of chat history, or alternatively, filters and compresses information in chat history.</p>
<p>To be implemented&hellip;</p>
<h2 id="component">Component</h2>
<h3 id="retrieval">Retrieval</h3>
<p>In all Prompts&rsquo; Contexts, aside from Chat History session information, information based on external document libraries, code repositories, internet search results is also relied upon. This knowledge system beyond the model parameters can significantly enhance the Agent&rsquo;s ability to complete complex tasks.</p>
<p>Thus, in MuAgent, we integrated three ways to retrieve information: Doc, Internet Search, Code Retrieval, and defined an abstract class IMRetrieval, supporting developers to customize their knowledge bases to complete the Agent&rsquo;s knowledge base registration.</p>
<p><strong>Doc Retrieval</strong></p>
<p>Document vector databases are currently the mainstream method for building knowledge bases, using Text Embedding models to vectorize documents and store them in vector databases. In the future, we will also support queries based on knowledge graphs and automatically extract entities and relations through large models to explore the complex relationships in data.</p>
<p><strong>Code Retrieval</strong></p>
<p>LLMs face the challenge of lagging training data for code generation, repair, and component understanding tasks, as well as not being able to perceive the context-dependent structure of code. During development, understanding, retrieving and querying metadata from the existing codebase and dependencies can take a considerable amount of time. Hence, we hope to provide an external knowledge system</p>
<p><strong>Search Retrieval</strong>
In addition to the readily available document and code knowledge bases, in daily practice, browsing a large amount of web content to acquire more knowledge helps us understand emerging scenarios, businesses, technologies, and more. Hence, we&rsquo;ve integrated duckduckgosearch, an open-source search tool, to provide LLMs with content beyond their knowledge reserves.</p>
<h3 id="tool">Tool</h3>
<p>With OpenAI launching the Function Call feature, which generates parameters for specified tools through LLM and executes the call, machines can better understand and respond to human needs, thus solving practical problems and repetitive work. Nowadays, the ability to learn tools is increasingly becoming a standard feature of open-source models. Therefore, in MuAgent, it also supports agents to complete Tool registration. By using the Python registration template BaseToolModel class and writing related properties and methods such as Tool_name, Tool_description, ToolInputArgs, ToolOutputArgs, and run, tools can be quickly integrated. It also supports the direct use of langchain Tool interfaces.
For example, functions like the above XXRetrieval can also be registered as a Tool, ultimately called by LLM.</p>
<h3 id="action">Action</h3>
<p>In the definition of MuAgent, Action is viewed as a specific action or action flow that LLM needs to execute, including LLM information processing, knowledge retrieval, tool invocation, and code execution, etc., constituting a comprehensive and complex dynamic process. For instance, in the React process, we obtained a Tool parameter through LLM, and then &ldquo;putting the tool parameter into the Tool and executing the call&rdquo; is an Action, which practically invokes the Tool. Or, we defined an Agent, who orchestrates a fixed agent&rsquo;s Action steps, with the input parameters of this Agent specially designated by the Action. That is to say, whether the parameters are generated by LLM or set by engineering, as long as it involves a specific execution process, it is an Action.</p>
<h2 id="modules">Modules</h2>
<ul>
<li><a href="/muagent/connector-agent">connector</a> Mainly introduces the work of this block of the Agent framework</li>
<li>llm_models</li>
<li>retrieval</li>
<li>tools</li>
<li>sandbox</li>
<li>utils</li>
</ul>

      </div>
      








  
  
  
        

      
    
        

        
          
        

        
        
      


<footer id="article-footer">
  <time id="article-last-updated" datetime="2024-04-09"><i class="icon icon-calendar"></i>&nbsp;Last updated: 2024-04-09</time>

  

  
    <a id="article-next-link"  data-first-page=true  href="/muagent/agent-flow/">Next <i class="icon icon-next icon-colored"></i></a>
  
</footer>
    </article>
    <aside id="toc">
  <span class="btn-close"><i class="icon icon-close"></i></span>
  <div class="sticky">
    <strong><i class="icon icon-toc"></i> On this page</strong>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#agent-base">Agent Base</a></li>
    <li><a href="#communication">Communication</a></li>
    <li><a href="#context-manager">Context Manager</a>
      <ul>
        <li><a href="#memory-manager">Memory Manager</a></li>
        <li><a href="#prompt-manager">Prompt Manager</a></li>
      </ul>
    </li>
    <li><a href="#component">Component</a>
      <ul>
        <li><a href="#retrieval">Retrieval</a></li>
        <li><a href="#tool">Tool</a></li>
        <li><a href="#action">Action</a></li>
      </ul>
    </li>
    <li><a href="#modules">Modules</a></li>
  </ul>
</nav>
  </div>
</aside>
  </main>
</div>

    <footer id="site-footer">
  
  <div id="site-footer-copyright">
    <a href="https://github.com/codefuse-ai" target="_blank">
      <i class="icon icon-copyright"></i> 2023-2024 codefuse-ai
    </a>
  </div>

  
  <div id="site-footer-social">

    

    

    
    <a href="https://github.com/codefuse-ai" target="_blank" aria-label="github url">
      <i class="icon icon-github icon-colored"></i>
    </a>
    

    

  </div>

  
  <div id="site-footer-fund">

    

    

  </div>

  
  <div id="site-footer-love">
    Made with <i class="icon icon-love icon-colored"></i> &nbsp;from&nbsp;<a href="https://docura.github.io/" target="_blank">Docura</a>
  </div>
</footer>
    






<script type="text/javascript" src="/js/base.min.js"></script>



  
  <script src="/js/component/docsearch.min.js"></script>
  <script type="application/javascript">
      docsearch({
          container: '#site-header-search',
          appId: '',
          indexName: '',
          apiKey: '',
      });
  </script>


<script type="application/javascript">
    if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js?2024-04-09')
            .catch(function(err) {console.error('ServiceWorker registration failed: ', err);});
    }
</script>
  </body>
</html>