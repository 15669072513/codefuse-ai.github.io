<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="CodeFuse aims to develop Code Large Language Models (Code LLMs) to support and enhance full-lifecycle AI native sotware developing, covering crucial stages such as design requirements, coding, testing, building, deployment, operations, and insight analysis.">
<meta name="author" content="codefuse-ai">

<title>Connector Prompt · CodeFuse-AI</title>

<link rel="canonical" href="/coagent/connector-prompt/">









<link rel="stylesheet" href="/scss/base.css" integrity="">



<link rel="stylesheet" href="/scss/theme/default.css" integrity="">



  <link rel="preconnect" href="https://-dsn.algolia.net" crossorigin />
  
  <link rel="stylesheet" href="/scss/component/docsearch.css" integrity=""/>

<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/img/icon/favicon.ico">
<link rel="icon" href="/img/icon/icon-16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/img/icon/icon-32.png" sizes="32x32" type="image/png">
<link rel="apple-touch-icon" href="/img/icon/icon-180.png" sizes="180x180">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-xxxx"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-xxxx');
</script>


  
  

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css">
  </head>
  <body>
    <header id="site-header">
  
  <div id="site-header-brand">
    <a href="/">CodeFuse-AI</a>
  </div>

  
  <div id="site-header-controls">
    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="theme selector">
        <i class="icon icon-brightness"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        <li role="menuitem"><button class="color-scheme" data-value="light"><i class="icon icon-light-mode"></i> Light</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="dark"><i class="icon icon-dark-mode"></i> Dark &nbsp;</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="night"><i class="icon icon-night-mode"></i> Night</button></li>
      </ul>
    </div>

    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="language selector">
        <i class="icon icon-translate"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        
          
          <li role="menuitem"><a href="/coagent/connector-prompt/">English</a></li>
          
          <li role="menuitem"><a href="/zh/coagent/connector-prompt-zh/">中文</a></li>
          
        
      </ul>
    </div>
  </div>

  
  <div id="site-header-menu">
    <nav>
      <ul>
        
        
        
          
          <li><a href="/" ><i class='icon icon-home'></i>Home</a></li>
        
          
          <li><a href="/docs" ><i class='icon icon-book'></i>Overview</a></li>
        
          
          <li><a href="/muagent" ><i class='icon icon-book'></i>MuAgent</a></li>
        
          
          <li><a href="/contribution" ><i class='icon icon-book'></i>Contribution</a></li>
        
      </ul>
    </nav>
  </div>

  
  <div id="site-header-search"></div>
</header>
    
<div id="site-main-content-wrapper">
  
  
    <aside id="sidebar">
  <span class="btn-close"><i class="icon icon-close"></i></span>

  <div class="sticky"><strong class="sidebar-section">❤️ CoAgent</strong>
          
          <a class="sidebar-link " href="/coagent/coagent-overview/">
            
              CoAgent Overview
            
          </a>

        
          
          <a class="sidebar-link " href="/coagent/agent-flow/">
            
              Agent Flow
            
          </a>

        
          
          <a class="sidebar-link " href="/coagent/prompt-manager/">
            
              Prompt Manager
            
          </a>

        
          
          <a class="sidebar-link " href="/coagent/quick-start/">
            
              Quick Start
            
          </a>

        <strong class="sidebar-section">Modules</strong>
          
          <a class="sidebar-link " href="/coagent/connector-agent/">
            
              Connector-Agent
            
          </a>

        
          
          <a class="sidebar-link " href="/coagent/connector-chain/">
            
              Connector-Chain
            
          </a>

        
          
          <a class="sidebar-link " href="/coagent/connector-phase/">
            
              Connector-Phase
            
          </a>

        
          
          <a class="sidebar-link current" href="/coagent/connector-prompt/">
            
              Connector-Prompt
            
          </a>

        
          
          <a class="sidebar-link " href="/coagent/connector-memory/">
            
              Connector-Memory
            
          </a>

        
          
          <a class="sidebar-link " href="/coagent/customed-examples/">
            
              Customed Examples
            
          </a>

        
  </div>
</aside>
  
  <main>
    <article id="article">
      <nav id="article-nav">
  <button id="article-nav-menu-btn"><i class="icon icon-menu"></i> On this section</button>
  
</nav>
      <header id="article-header">
  <h1>Connector Prompt</h1>
</header>
      <div id="article-content">
        
        
        <h2 id="prompt-的标准结构">Prompt 的标准结构</h2>
<p>在整个Prompt的整个结构中，我们需要去定义三个部分</p>
<ul>
<li>Agent Profil</li>
<li>Input Format</li>
<li>Response Output Format</li>
</ul>
<pre tabindex="0"><code>#### Agent Profile

Agent Description ...

#### Input Format

**Origin Query:** the initial question or objective that the user wanted to achieve

**Context:** the current status and history of the tasks to determine if Origin Query has been achieved.

#### Response Output Format
**Action Status:** finished or continued
If it&#39;s &#39;finished&#39;, the context can answer the origin query.
If it&#39;s &#39;continued&#39;, the context cant answer the origin query.

**REASON:** Justify the decision of choosing &#39;finished&#39; and &#39;continued&#39; by evaluating the progress step by step.
Consider all relevant information. If the tasks were aimed at an ongoing process, assess whether it has reached a satisfactory conclusion.
</code></pre><p>其中，我们整合了部分 <code>Input Format</code> 的通用操作，内置了一部分字段和操作流程,形成通用的配置化操作。如下所示
只需要定义如下字段和执行函数，</p>
<pre tabindex="0"><code>AUTO_FEEDBACK_FROM_CODE_EXECUTION_PROMPT_CONFIGS = [
    {&#34;field_name&#34;: &#39;agent_profile&#39;, &#34;function_name&#34;: &#39;handle_agent_profile&#39;, &#34;is_context&#34;: False},
    {&#34;field_name&#34;: &#39;context_placeholder&#39;, &#34;function_name&#34;: &#39;&#39;, &#34;is_context&#34;: True},
    {&#34;field_name&#34;: &#39;session_records&#39;, &#34;function_name&#34;: &#39;handle_session_records&#39;},
    {&#34;field_name&#34;: &#39;output_format&#39;, &#34;function_name&#34;: &#39;handle_output_format&#39;, &#39;title&#39;: &#39;Response Output Format&#39;, &#34;is_context&#34;: False},
    {&#34;field_name&#34;: &#39;begin!!!&#39;, &#34;function_name&#34;: &#39;handle_response&#39;, &#34;is_context&#34;: False, &#34;omit_if_empty&#34;: False}
]
</code></pre><p>未来我们会也会进一步将 Agent Profile和Response Output Format的部分，实现可配置化操作，降低Prompt编写难度</p>
<h3 id="自定义-input-format">自定义 Input Format</h3>
<p>同时，我们也支持 用户自定义 Input Format 的操作</p>
<pre tabindex="0"><code>from coagent.connector.prompt_manager import PromptManager

# 增加了两个新处理函数，用于prompt组装
class CodeRetrievalPM(PromptManager):
    def handle_code_packages(self, **kwargs) -&gt; str:
        if &#39;previous_agent_message&#39; not in kwargs:
            return &#34;&#34;
        previous_agent_message: Message = kwargs[&#39;previous_agent_message&#39;]
        # 由于两个agent共用了同一个manager，所以临时性处理
        vertices = previous_agent_message.customed_kargs.get(&#34;RelatedVerticesRetrivalRes&#34;, {}).get(&#34;vertices&#34;, [])
        return &#34;, &#34;.join([str(v) for v in vertices])

    def handle_retrieval_codes(self, **kwargs) -&gt; str:
        if &#39;previous_agent_message&#39; not in kwargs:
            return &#34;&#34;
        previous_agent_message: Message = kwargs[&#39;previous_agent_message&#39;]
        return &#39;\n&#39;.join(previous_agent_message.customed_kargs[&#34;Retrieval_Codes&#34;])


# Design your personal PROMPT INPPUT FORMAT 
CODE_RETRIEVAL_PROMPT_CONFIGS = [
    {&#34;field_name&#34;: &#39;agent_profile&#39;, &#34;function_name&#34;: &#39;handle_agent_profile&#39;, &#34;is_context&#34;: False},
    {&#34;field_name&#34;: &#39;tool_information&#39;,&#34;function_name&#34;: &#39;handle_tool_data&#39;, &#34;is_context&#34;: False},
    {&#34;field_name&#34;: &#39;context_placeholder&#39;, &#34;function_name&#34;: &#39;&#39;, &#34;is_context&#34;: True},
    {&#34;field_name&#34;: &#39;reference_documents&#39;, &#34;function_name&#34;: &#39;handle_doc_info&#39;},
    {&#34;field_name&#34;: &#39;session_records&#39;, &#34;function_name&#34;: &#39;handle_session_records&#39;},
    {&#34;field_name&#34;: &#39;retrieval_codes&#39;, &#34;function_name&#34;: &#39;handle_retrieval_codes&#39;},
    {&#34;field_name&#34;: &#39;code_packages&#39;, &#34;function_name&#34;: &#39;handle_code_packages&#39;},
    {&#34;field_name&#34;: &#39;output_format&#39;, &#34;function_name&#34;: &#39;handle_output_format&#39;, &#39;title&#39;: &#39;Response Output Format&#39;, &#34;is_context&#34;: False},
    {&#34;field_name&#34;: &#39;begin!!!&#39;, &#34;function_name&#34;: &#39;handle_response&#39;, &#34;is_context&#34;: False, &#34;omit_if_empty&#34;: False}
    ]

# 进行注册
import importlib
prompt_manager_module = importlib.import_module(&#34;coagent.connector.prompt_manager&#34;)
setattr(prompt_manager_module, &#39;CodeRetrievalPM&#39;, CodeRetrievalPM)

# 更新配置
from coagent.connector.configs import AGETN_CONFIGS
AGETN_CONFIGS.update({
    &#34;codeRetrievalJudger&#34;: {
        &#34;role&#34;: {
            &#34;role_prompt&#34;: codeRetrievalJudger_PROMPT,
            &#34;role_type&#34;: &#34;assistant&#34;,
            &#34;role_name&#34;: &#34;codeRetrievalJudger&#34;,
            &#34;role_desc&#34;: &#34;&#34;,
            &#34;agent_type&#34;: &#34;CodeRetrievalJudger&#34;
            # &#34;agent_type&#34;: &#34;BaseAgent&#34;
        },
        &#34;prompt_config&#34;: CODE_RETRIEVAL_PROMPT_CONFIGS,
        &#34;prompt_manager_type&#34;: &#34;CodeRetrievalPM&#34;,
        &#34;chat_turn&#34;: 1,
        &#34;focus_agents&#34;: [],
        &#34;focus_message_keys&#34;: [],
    },
    }）
</code></pre><p>在我们构建phase、chain或者agent之后，可以通过函数的预打印功能，实现agents链路确认，避免在执行后才发现问题，可提前进行debug</p>
<pre tabindex="0"><code>llm_config = LLMConfig(
    model_name=&#34;gpt-3.5-turbo&#34;, model_device=&#34;cpu&#34;,api_key=os.environ[&#34;OPENAI_API_KEY&#34;], 
    api_base_url=os.environ[&#34;API_BASE_URL&#34;], temperature=0.3
    )
embed_config = EmbedConfig(
    embed_engine=&#34;model&#34;, embed_model=&#34;text2vec-base-chinese&#34;, 
    embed_model_path=&#34;D://project/gitlab/llm/external/ant_code/Codefuse-chatbot/embedding_models/text2vec-base-chinese&#34;
    )

phase_name = &#34;baseGroupPhase&#34;
phase = BasePhase(
    phase_name, embed_config=embed_config, llm_config=llm_config, 
)

phase.pre_print(query)

## 完整信息确认 coagent.connector.configs中进行确认
##########################
&lt;&lt;&lt;&lt;baseGroup&#39;s prompt&gt;&gt;&gt;&gt;
##########################

### Agent Profile
Your goal is to response according the Context Data&#39;s information with the role that will best facilitate a solution, taking into account all relevant context (Context) provided.
When you need to select the appropriate role for handling a user&#39;s query, carefully read the provided role names, role descriptions and tool list.
ATTENTION: response carefully referenced &#34;Response Output Format&#34; in format.

### Tool Information

### Agent Infomation
        Please ensure your selection is one of the listed roles. Available roles for selection:
        &#34;role name: tool_react
role description:  Agent Profile,When interacting with users, your role is to respond in a helpful and accurate manner using the tools available. Follow the steps below to ensure efficient and effective use of the tools.,Please note that all the tools you can use are listed below. You can only choose from these tools for use. ,If there are no suitable tools, please do not invent any tools. Just let the user know that you do not have suitable tools to use.,ATTENTION: The Action Status field ensures that the tools or code mentioned in the Action can be parsed smoothly. Please make sure not to omit the Action Status field when replying.,&#34;
&#34;role name: code_react
role description:  Agent Profile,When users need help with coding, your role is to provide precise and effective guidance.,Write the code step by step, showing only the part necessary to solve the current problem. Each reply should contain only the code required for the current step.,&#34;
        Please ensure select the Role from agent names, such as tool_react, code_react

### Context Data

#### Reference Documents

#### Session Records

#### Current Plan

### Response Output Format
**Thoughts:** think the reason step by step about why you selecte one role
**Role:** Select the role from agent names.

### Begin!!!

###################
&lt;&lt;&lt;&lt;LLM PREDICT&gt;&gt;&gt;&gt;
###################

**Thoughts:**
**Role:**


###########################
&lt;&lt;&lt;&lt;tool_react&#39;s prompt&gt;&gt;&gt;&gt;
###########################
### Agent Profile
When interacting with users, your role is to respond in a helpful and accurate manner using the tools available. Follow the steps below to ensure efficient and effective use of the tools.
Please note that all the tools you can use are listed below. You can only choose from these tools for use.
If there are no suitable tools, please do not invent any tools. Just let the user know that you do not have suitable tools to use.
ATTENTION: The Action Status field ensures that the tools or code mentioned in the Action can be parsed smoothly. Please make sure not to omit the Action Status field when replying.

### Tool Information

### Context Data

#### Reference Documents

#### Session Records

#### Task Records

### Response Output Format
**Thoughts:** According the previous observations, plan the approach for using the tool effectively.
...

### Begin!!!

###################
&lt;&lt;&lt;&lt;LLM PREDICT&gt;&gt;&gt;&gt;
###################
**Thoughts:**
**Action Status:**
**Action:**
**Observation:**
**Thoughts:**
**Action Status:**
**Action:**

###########################
&lt;&lt;&lt;&lt;code_react&#39;s prompt&gt;&gt;&gt;&gt;
###########################
### Agent Profile
When users need help with coding, your role is to provide precise and effective guidance.
Write the code step by step, showing only the part necessary to solve the current problem. Each reply should contain only the code required for the current step.

### Context Data

#### Reference Documents

#### Session Records

### Response Output Format

**Thoughts:** According the previous context, solve the problem step by step, only displaying the thought process necessary for the current step of solving the problem,
outline the plan for executing this step.

**Action Status:** Set to &#39;stopped&#39; or &#39;code_executing&#39;.
If it&#39;s &#39;stopped&#39;, the action is to provide the final answer to the session records and executed steps.
If it&#39;s &#39;code_executing&#39;, the action is to write the code.
...

### Begin!!!

###################
&lt;&lt;&lt;&lt;LLM PREDICT&gt;&gt;&gt;&gt;
###################

**Thoughts:**
**Action Status:**
**Action:**
**Observation:**
**Thoughts:**
**Action Status:**
**Action:**
</code></pre>
      </div>
      








  
  
  
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

      
    
        

        
          
        

        
        


<footer id="article-footer">
  <time id="article-last-updated" datetime="2024-01-25"><i class="icon icon-calendar"></i>&nbsp;Last updated: 2024-01-25</time>

  
    <a id="article-prev-link" href="/coagent/connector-phase/"><i class="icon icon-prev icon-colored"></i> Prev</a>
  

  
    <a id="article-next-link"  href="/coagent/connector-memory/">Next <i class="icon icon-next icon-colored"></i></a>
  
</footer>
    </article>
    <aside id="toc">
  <span class="btn-close"><i class="icon icon-close"></i></span>
  <div class="sticky">
    <strong><i class="icon icon-toc"></i> On this page</strong>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#prompt-的标准结构">Prompt 的标准结构</a>
      <ul>
        <li><a href="#自定义-input-format">自定义 Input Format</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</aside>
  </main>
</div>

    <footer id="site-footer">
  
  <div id="site-footer-copyright">
    <a href="https://github.com/codefuse-ai" target="_blank">
      <i class="icon icon-copyright"></i> 2023-2024 codefuse-ai
    </a>
  </div>

  
  <div id="site-footer-social">

    

    

    
    <a href="https://github.com/codefuse-ai" target="_blank" aria-label="github url">
      <i class="icon icon-github icon-colored"></i>
    </a>
    

    

  </div>

  
  <div id="site-footer-fund">

    

    

  </div>

  
  <div id="site-footer-love">
    Made with <i class="icon icon-love icon-colored"></i> &nbsp;from&nbsp;<a href="https://docura.github.io/" target="_blank">Docura</a>
  </div>
</footer>
    






<script type="text/javascript" src="/js/base.min.js"></script>



  
  <script src="/js/component/docsearch.min.js"></script>
  <script type="application/javascript">
      docsearch({
          container: '#site-header-search',
          appId: '',
          indexName: '',
          apiKey: '',
      });
  </script>


<script type="application/javascript">
    if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js?2024-04-09')
            .catch(function(err) {console.error('ServiceWorker registration failed: ', err);});
    }
</script>
  </body>
</html>