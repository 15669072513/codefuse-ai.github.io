<!DOCTYPE html>
<html lang="en-CN">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="CodeFuse介绍主要功能">
<meta name="author" content="codefuse-ai">

<title>查询语言介绍 · CodeFuse-AI</title>

<link rel="canonical" href="/docs/codefuse-query-godellanguage-zh/">









<link rel="stylesheet" href="/scss/base.css" integrity="">



<link rel="stylesheet" href="/scss/theme/default.css" integrity="">



<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/img/icon/favicon.ico">
<link rel="icon" href="/img/icon/icon-16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/img/icon/icon-32.png" sizes="32x32" type="image/png">
<link rel="apple-touch-icon" href="/img/icon/icon-180.png" sizes="180x180">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-xxxx"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-xxxx');
</script>


  
  

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css">
  </head>
  <body>
    <header id="site-header">
  
  <div id="site-header-brand">
    <a href="/">CodeFuse-AI</a>
  </div>

  
  <div id="site-header-controls">
    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="theme selector">
        <i class="icon icon-brightness"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        <li role="menuitem"><button class="color-scheme" data-value="light"><i class="icon icon-light-mode"></i> Light</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="dark"><i class="icon icon-dark-mode"></i> Dark &nbsp;</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="night"><i class="icon icon-night-mode"></i> Night</button></li>
      </ul>
    </div>

    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="language selector">
        <i class="icon icon-translate"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        
          
          <li role="menuitem"><a href="/docs/codefuse-query-godellanguage/">English</a></li>
          
          <li role="menuitem"><a href="/docs/codefuse-query-godellanguage-zh/">中文</a></li>
          
        
      </ul>
    </div>
  </div>

  
  <div id="site-header-menu">
    <nav>
      <ul>
        
        
        
          
          <li><a href="/" ><i class='icon icon-home'></i>Home</a></li>
        
          
          <li><a href="/docs"  class="active"><i class='icon icon-book'></i>Overview</a></li>
        
          
          <li><a href="/muagent" ><i class='icon icon-book'></i>MuAgent</a></li>
        
          
          <li><a href="/contribution" ><i class='icon icon-book'></i>Contribution</a></li>
        
      </ul>
    </nav>
  </div>

  
  <div id="site-header-search"></div>
</header>
    
<div id="site-main-content-wrapper">
  
  
    <aside id="sidebar">
  <span class="btn-close"><i class="icon icon-close"></i></span>

  <div class="sticky"><strong class="sidebar-section">📖 CodeFuse-AI 整体介绍</strong>
          
          <a class="sidebar-link " href="/docs/%E6%A6%82%E8%A7%88/">
            
              概览
            
          </a>

        <strong class="sidebar-section">📖 CodeFuse-AI 模块</strong>
          
          <a class="sidebar-link " href="/docs/codefuse-query-zh/">
            
              CodeFuse-Query
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/mftcoder-zh/">
            
              MFTCoder
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-mft-vlm-zh/">
            
              CodeFuse-MFT-VLM
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/test-agent-zh/">
            
              Test-Agent
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-modelcache-zh/">
            
              CodeFuse-ModelCache
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-chatbot-zh/">
            
              CodeFuse-ChatBot
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-devops-eval-zh/">
            
              CodeFuse-DevOps-Eval
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-devops-model-zh/">
            
              CodeFuse-DevOps-Model
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-evalution-zh/">
            
              CodeFuse-Evalution
            
          </a>

        <strong class="sidebar-section">CodeFuse-Query</strong>
          
          <a class="sidebar-link " href="/docs/codefuse-query-introduction-zh/">
            
              基本介绍
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-query-quickstart-zh/">
            
              快速开始
            
          </a>

        
          
          <a class="sidebar-link current" href="/docs/codefuse-query-godellanguage-zh/">
            
              查询语言介绍
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-query-toolchain-zh/">
            
              VSCode插件
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-query-usercase-zh/">
            
              用户案例
            
          </a>

        <strong class="sidebar-section">MFTCoder</strong>
          
          <a class="sidebar-link " href="/docs/mftcoder-introduction-zh/">
            
              基本介绍
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/mftcoder-quickstart-zh/">
            
              快速使用
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/mftcoder-accelerate-zh/">
            
              Accelerate &#43; DeepSpeed/FSDP 框架篇
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/mftcoder-atorch-zh/">
            
              Atorch框架篇
            
          </a>

        <strong class="sidebar-section">CodeFuse-MFT-VLM</strong>
          
          <a class="sidebar-link " href="/docs/codefuse-mft-vlm-quickstart-zh/">
            
              快速使用
            
          </a>

        <strong class="sidebar-section">🌱 Test Agent</strong>
          
          <a class="sidebar-link " href="/docs/test-agent-quickstart-zh/">
            
              快速开始
            
          </a>

        <strong class="sidebar-section">🌱 CodeFuse-ModelCache</strong>
          
          <a class="sidebar-link " href="/docs/codefuse-modelcache-quickstart-zh/">
            
              快速开始
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-modelcache-feature-zh/">
            
              功能特性
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-modelcache-config-zh/">
            
              最佳配置
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-modelcache-release-zh/">
            
              版本记录
            
          </a>

        <strong class="sidebar-section">🌱 CodeFuse-ChatBot</strong>
          
          <a class="sidebar-link " href="/docs/codefuse-chatbot-quickstart-zh/">
            
              快速开始
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/%E5%90%AF%E5%8A%A8%E6%98%8E%E7%BB%86/">
            
              启动明细
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/%E6%9C%AC%E5%9C%B0%E7%A7%81%E6%9C%89%E5%8C%96%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%8F%A3%E6%8E%A5%E5%85%A5/">
            
              本地私有化&amp;大模型接口接入
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/chatbot-%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF/">
            
              ChatBot 技术路线
            
          </a>

        <strong class="sidebar-section">🌱 CodeFuse-DevOps-Model</strong>
          
          <a class="sidebar-link " href="/docs/codefuse-devops-model-train-zh/">
            
              训练解析
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-devops-model-quickstart-zh/">
            
              快速使用
            
          </a>

        <strong class="sidebar-section">🌱 CodeFuse-DevOps-Eval</strong>
          
          <a class="sidebar-link " href="/docs/%E6%95%B0%E6%8D%AE%E4%BB%8B%E7%BB%8D/">
            
              数据介绍
            
          </a>

        
          
          <a class="sidebar-link " href="/docs/codefuse-devops-eval-quickstart-zh/">
            
              快速开始
            
          </a>

        <strong class="sidebar-section">🌱 CodeFuse-evalution</strong>
          
          <a class="sidebar-link " href="/docs/codefuse-evalution-quickstart-zh/">
            
              快速开始
            
          </a>

        
  </div>
</aside>
  
  <main>
    <article id="article">
      <nav id="article-nav">
  <button id="article-nav-menu-btn"><i class="icon icon-menu"></i> On this section</button>
  
</nav>
      <header id="article-header">
  <h1>查询语言介绍</h1>
</header>
      <div id="article-content">
        
        
        <h1 id="gödelscript-查询语言">GödelScript 查询语言</h1>
<h2 id="目录">目录</h2>
<ul>
<li><a href="#g%C3%B6delscript-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E8%AF%AD%E6%B3%95">GödelScript 基本概念和语法</a>
<ul>
<li><a href="#%E7%AE%80%E4%BB%8B">简介</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E7%A8%8B%E5%BA%8F%E6%9E%84%E6%88%90">基本程序构成</a></li>
<li><a href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BC%96%E8%AF%91%E5%99%A8%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0">基础类型和编译器内建函数</a></li>
<li><a href="#%E5%87%BD%E6%95%B0">函数</a></li>
<li><a href="#%E8%AF%AD%E5%8F%A5">语句</a></li>
<li><a href="#schema">Schema</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a></li>
<li><a href="#trait">Trait</a></li>
<li><a href="#import">Import</a></li>
<li><a href="#query">Query</a></li>
<li><a href="#ungrounded-error-%E6%9C%AA%E8%B5%8B%E5%80%BC%E6%9C%AA%E7%BB%91%E5%AE%9A%E9%94%99%E8%AF%AF">Ungrounded Error: 未赋值/未绑定错误</a></li>
</ul>
</li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B">查询示例</a>
<ul>
<li><a href="#java">Java</a></li>
<li><a href="#python">Python</a></li>
<li><a href="#javascript">JavaScript</a></li>
<li><a href="#xml">XML</a></li>
<li><a href="#go">Go</a></li>
</ul>
</li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E8%B0%83%E8%AF%95%E5%92%8C%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7">查询调试和优化技巧</a>
<ul>
<li><a href="#schema-%E4%BC%A0%E5%8F%82%E5%AF%BC%E8%87%B4%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E8%BF%87%E5%A4%A7">Schema 传参导致笛卡尔积过大</a></li>
<li><a href="#%E5%A4%9A%E5%B1%82-for-%E5%AF%BC%E8%87%B4%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E8%BF%87%E5%A4%A7">多层 for 导致笛卡尔积过大</a></li>
<li><a href="#%E4%B8%8D%E8%A6%81%E6%BB%A5%E7%94%A8inline%E5%BF%85%E9%A1%BB%E7%94%A8inline%E7%9A%84%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">不要滥用<code>@inline</code></a></li>
</ul>
</li>
<li><a href="#%E5%9C%A8%E6%9C%AC%E6%9C%BA%E4%BD%BF%E7%94%A8%E6%9F%A5%E8%AF%A2%E8%84%9A%E6%9C%AC%E6%B5%81%E7%A8%8B">在本机使用查询脚本流程</a></li>
</ul>
<h2 id="gödelscript-基本概念和语法">GödelScript 基本概念和语法</h2>
<h3 id="简介">简介</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">hello</span><span class="p">(</span><span class="n">greeting</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;hello world!&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">hello</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>GödelScript 即 Gödel 查询语言。GödelScript 是 CodeQuery 用于查询和数据处理的领域专用语言 (DSL)。GödelScript 使用了类 Rust 的语法，提供了严格的类型检查、方便快捷的类型推导、智能友好的错误提示信息，使用户能够快速上手。</p>
<p>GödelScript 编译器主要应用场景为：</p>
<ol>
<li>面向用户编写简单或复杂查询，提供更便捷的写法，提高编写查询的效率；</li>
<li>提供严格类型检查与类型推导，给予更智能的代码修改提示；</li>
<li>提供严格的 <a href="#ungrounded-error-%E6%9C%AA%E8%B5%8B%E5%80%BC%E6%9C%AA%E7%BB%91%E5%AE%9A%E9%94%99%E8%AF%AF">ungrounded(未赋值/未绑定)</a> 检测，避免触发 Soufflé Ungrounded Error；</li>
<li>Language Server 以及 IDE Extension 支持。</li>
</ol>
<h3 id="基本程序构成">基本程序构成</h3>
<h4 id="程序结构">程序结构</h4>
<p>GödelScript 程序可能包含:</p>
<ul>
<li><a href="#import">模块和符号引用</a></li>
<li><a href="#schema">Schema 类型声明</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">数据库类型声明</a></li>
<li><a href="#trait">Trait 声明</a></li>
<li><a href="#%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0">Schema 方法实现</a></li>
<li><a href="#%E5%87%BD%E6%95%B0">函数声明和实现</a></li>
<li><a href="#query">Query 声明</a></li>
</ul>
<p>包含以上所有组成内容的样例:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1">// 包引入/符号引入
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="o">*</span><span class="w"> </span><span class="c1">// 引入所有符号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="p">{</span><span class="n">JavaDB</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="p">}</span><span class="w"> </span><span class="c1">// 选择性引入符号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 函数声明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;example.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// schema 声明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">schema</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">primary</span><span class="w"> </span><span class="n">id</span>: <span class="nc">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// database 声明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">database</span><span class="w"> </span><span class="n">NewDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">file</span>: <span class="o">*</span><span class="n">File</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// trait 声明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">trait</span><span class="w"> </span><span class="n">FileTrait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getId</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// impl trait for
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">FileTrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getId</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// impl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">all</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="mi">1</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="mi">2</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// query
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">query</span><span class="w"> </span><span class="n">get_all_anno</span><span class="w"> </span><span class="n">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Annotation</span><span class="w"> </span><span class="n">anno</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Annotation</span><span class="p">(</span><span class="n">default_db</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">anno</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="w">
</span></span></span></code></pre></div><h4 id="注释">注释</h4>
<p>GödelScript 采用类 C 语言的注释方式。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// 单行注释
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">* 1. 多行注释
</span></span></span><span class="line"><span class="cl"><span class="cm">* 2. 多行注释
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h4 id="main-函数"><code>main</code> 函数</h4>
<p>GödelScript 查询脚本可以包含<code>main</code>函数，该函数无返回值。在不实现<code>main</code>函数，且没有写 query 声明的情况下，程序不会输出。</p>
<p>更多详细内容请看 <a href="#g%C3%B6delscript-main-%E5%87%BD%E6%95%B0">main 函数</a>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">query_1</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">query_2</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="基础类型和编译器内建函数">基础类型和编译器内建函数</h3>
<p>GödelScript 包含基础类型<code>int</code> <code>string</code>，<code>bool</code>属于基础类型，但是不能作为值存储。</p>
<h4 id="int类型-native-函数"><code>int</code>类型 native 函数</h4>
<table>
<thead>
<tr>
<th>函数</th>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>pow</td>
<td>(int, int) -&gt; int</td>
<td>乘方。参数只能非负数。</td>
</tr>
<tr>
<td>rem</td>
<td>(int, int) -&gt; int</td>
<td>取余。</td>
</tr>
<tr>
<td>bitand</td>
<td>(int, int) -&gt; int</td>
<td>按位与。</td>
</tr>
<tr>
<td>bitor</td>
<td>(int, int) -&gt; int</td>
<td>按位或。</td>
</tr>
<tr>
<td>bitxor</td>
<td>(int, int) -&gt; int</td>
<td>按位异或。</td>
</tr>
<tr>
<td>bitnot</td>
<td>(int) -&gt; int</td>
<td>按位非。</td>
</tr>
<tr>
<td>neg</td>
<td>(int) -&gt; int</td>
<td>算术取反。</td>
</tr>
<tr>
<td>to_string</td>
<td>(int) -&gt; string</td>
<td>转换为字符串。</td>
</tr>
<tr>
<td>add</td>
<td>(int, int) -&gt; int</td>
<td>+</td>
</tr>
<tr>
<td>sub</td>
<td>(int, int) -&gt; int</td>
<td>-</td>
</tr>
<tr>
<td>mul</td>
<td>(int, int) -&gt; int</td>
<td>*</td>
</tr>
<tr>
<td>div</td>
<td>(int, int) -&gt; int</td>
<td>/</td>
</tr>
<tr>
<td>eq</td>
<td>(int, int) -&gt; bool</td>
<td>=</td>
</tr>
<tr>
<td>ne</td>
<td>(int, int) -&gt; bool</td>
<td>!=</td>
</tr>
<tr>
<td>gt</td>
<td>(int, int) -&gt; bool</td>
<td>&gt;</td>
</tr>
<tr>
<td>ge</td>
<td>(int, int) -&gt; bool</td>
<td>&gt;=</td>
</tr>
<tr>
<td>lt</td>
<td>(int, int) -&gt; bool</td>
<td>&lt;</td>
</tr>
<tr>
<td>le</td>
<td>(int, int) -&gt; bool</td>
<td>&lt;=</td>
</tr>
<tr>
<td>to_set</td>
<td>(int) -&gt; *int</td>
<td>转为集合类型。</td>
</tr>
</tbody>
</table>
<h4 id="string类型-native-函数"><code>string</code>类型 native 函数</h4>
<table>
<thead>
<tr>
<th>函数</th>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>len</td>
<td>(string) -&gt; int</td>
<td>获取字符串长度。</td>
</tr>
<tr>
<td>substr</td>
<td>(string, int, int) -&gt; string</td>
<td>通过初始index和length来截取字符串。</td>
</tr>
<tr>
<td>contains</td>
<td>(string, string) -&gt; bool</td>
<td>判断一个字符串是否被包含在当前字符串中。</td>
</tr>
<tr>
<td>matches</td>
<td>(string, string) -&gt; bool</td>
<td>判断正则字符串是否完全匹配当前字符串。</td>
</tr>
<tr>
<td>get_regex_match_result</td>
<td>(string, string, int) -&gt; string</td>
<td>获取被正则字符串完全匹配当前字符串时的某一个捕获结果，该结果由第二个参数（int）确定。如 &ldquo;abcdef&rdquo;.get_regex_match_result(&ldquo;a(.*)f&rdquo;, 1) 的结果是 &ldquo;bcde&rdquo;。</td>
</tr>
<tr>
<td>to_int</td>
<td>(string) -&gt; int</td>
<td>转换为整数。</td>
</tr>
<tr>
<td>add</td>
<td>(string, string) -&gt; string</td>
<td>字符串拼接。</td>
</tr>
<tr>
<td>eq</td>
<td>(string, string) -&gt; bool</td>
<td>判断字符串相等。</td>
</tr>
<tr>
<td>ne</td>
<td>(string, string) -&gt; bool</td>
<td>判断字符串不相等。</td>
</tr>
<tr>
<td>to_set</td>
<td>(string) -&gt; *string</td>
<td>转为集合类型。</td>
</tr>
</tbody>
</table>
<h4 id="bool类型-native-函数"><code>bool</code>类型 native 函数</h4>
<p><code>bool</code>虽然作为基础类型存在，但是该类型不能作为数据参与中间计算，只能作为条件结果。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>not</td>
<td>(bool) -&gt; bool</td>
<td>条件取反。</td>
</tr>
<tr>
<td>and</td>
<td>(bool, bool) -&gt; bool</td>
<td>条件与。</td>
</tr>
<tr>
<td>or</td>
<td>(bool, bool) -&gt; bool</td>
<td>条件或。</td>
</tr>
<tr>
<td>eq</td>
<td>(bool, bool) -&gt; bool</td>
<td>相等。</td>
</tr>
<tr>
<td>ne</td>
<td>(bool, bool) -&gt; bool</td>
<td>不相等。</td>
</tr>
</tbody>
</table>
<h4 id="作用于集合的-native-函数">作用于集合的 native 函数</h4>
<table>
<thead>
<tr>
<th>函数</th>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>len</td>
<td>(*T) -&gt; int</td>
<td>获取数据集合的数量。</td>
</tr>
<tr>
<td>max</td>
<td>(*int) -&gt; int</td>
<td>查找最大值。</td>
</tr>
<tr>
<td>min</td>
<td>(*int) -&gt; int</td>
<td>查找最小值。</td>
</tr>
<tr>
<td>sum</td>
<td>(*int) -&gt; int</td>
<td>求和。</td>
</tr>
<tr>
<td>find</td>
<td>(*T0) -&gt; T1</td>
<td>从一个集合中，通过主键查找数据。</td>
</tr>
</tbody>
</table>
<h4 id="全局-native-函数">全局 native 函数</h4>
<table>
<thead>
<tr>
<th>函数</th>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>output</td>
<td>((&hellip;) -&gt; bool) -&gt; <null-type></td>
<td>输出 query 内容。</td>
</tr>
</tbody>
</table>
<h4 id="database-的-native-函数">database 的 native 函数</h4>
<table>
<thead>
<tr>
<th>函数</th>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>load</td>
<td>(string) -&gt; T</td>
<td>加载 database 。</td>
</tr>
</tbody>
</table>
<h4 id="schema-的-native-函数">schema 的 native 函数</h4>
<table>
<thead>
<tr>
<th>函数</th>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>to<T></td>
<td>(self) -&gt; T</td>
<td>转换到其他类型的 schema，采用 duck type 检测。</td>
</tr>
<tr>
<td>is<T></td>
<td>(self) -&gt; bool</td>
<td>判断是否可以是其他类型的 schema，采用 duck type 检测。如果自身 schema 有主键，则底层只会通过主键判断是否可以是其他类型。</td>
</tr>
<tr>
<td>key_eq</td>
<td>(self, T) -&gt; bool</td>
<td>检查两个 schema 实例的主键是否相等。</td>
</tr>
<tr>
<td>key_neq</td>
<td>(self, T) -&gt; bool</td>
<td>检查两个 schema 实例的主键是否不等。</td>
</tr>
</tbody>
</table>
<p>schema native 函数实例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_java_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_java_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">stmt</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">StatementParent</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stmt</span><span class="p">.</span><span class="n">is</span><span class="o">&lt;</span><span class="n">ElementParent</span><span class="o">&gt;</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">convert</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">ElementParent</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">stmt</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">StatementParent</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">ElementParent</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="函数">函数</h3>
<h4 id="gödelscript-main-函数">GödelScript <code>main</code> 函数</h4>
<p><code>main</code>函数是 GödelScript 中唯一不声明返回值的函数。<code>main</code>函数只允许使用<code>output</code>，其他语句会导致编译错误；多次使用<code>output(...)</code>可以输出多个查询结果，查询结果会分表显示，表名即为<code>output</code>中调用的查询函数的函数名。</p>
<h4 id="查询函数">查询函数</h4>
<p>查询函数的返回值类型推荐为<code>bool</code>，需要输出查询结果时，需要使用<code>output()</code>函数。</p>
<p>在<code>output()</code>中调用的查询函数不再是常规思路中的用传参调用函数。参数列表在此时会变化为输出表的表结构，下面是两个查询函数的应用实例：</p>
<ol>
<li>
<p>单表<code>output</code></p>
<p>单表<code>output</code>特指在<code>main</code>函数中，只使用一次<code>output</code>来输出。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">a</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">example</span><span class="p">())</span><span class="w"> </span><span class="c1">// 此时参数列表变为输出表结构，不需要传参
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>对应的输出表结构为:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="nt">&#34;a&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&#34;b&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="nt">&#34;a&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&#34;b&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div></li>
<li>
<p>多表<code>output</code></p>
<p>多表<code>output</code>是指在<code>main</code>函数中，使用多次<code>output</code>来输出。在这种情况下，输出数据会附带对应的表名。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">example0</span><span class="p">(</span><span class="n">a</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">example1</span><span class="p">(</span><span class="n">a</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">example0</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">example1</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>对应的输出表结构为:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;example0&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;a&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&#34;b&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;a&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&#34;b&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;example1&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;a&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">,</span> <span class="nt">&#34;b&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nt">&#34;a&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">,</span> <span class="nt">&#34;b&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ol>
<p>下面是一个比较详细的例子，在这个例子中，我们直接构造了两组数据并输出。在下列代码中，需要注意的是：</p>
<ol>
<li>
<p>GödelScript 中，布尔值可以使用<code>true</code>和<code>false</code>关键字。</p>
</li>
<li>
<p><code>=</code>符号在 GödelScript 中是比较特殊的符号，不能用常规的编程语言的思路来理解。GödelScript 是一种 Datalog 语言。在这里，<code>=</code>符号同时具备两种语义，一个是 <strong>赋值</strong> 一个是 <strong>判等</strong>。详情可看<a href="#%E8%B5%8B%E5%80%BC%E5%92%8C%E5%88%A4%E7%AD%89%E8%BF%90%E7%AE%97%E7%AC%A6"><code>=</code>运算符</a>。</p>
</li>
<li>
<p>在这个例子的条件语句中，<code>a</code>和<code>b</code>均使用了<code>=</code>的赋值语义，因为<code>int</code>和<code>string</code>类型参数在函数体中被认为是<code>ungrounded(未赋值/未绑定)</code>，必须要被赋值才能使用。</p>
</li>
<li>
<p><code>=</code>赋值语句的返回值是<code>true</code>。</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">a</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// = 符号同时具有赋值和比较的功能，取决于此时的左值是否已经“被赋值”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// 这里的 a 和 b 所用的 = 符号均是赋值语义
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;1&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// GödelScript 使用关键字 true 和 false 来表示布尔值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;2&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">example</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>预期的输出结果应该为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="nt">&#34;a&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&#34;b&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="nt">&#34;a&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nt">&#34;b&#34;</span><span class="p">:</span> <span class="s2">&#34;2&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h4 id="普通函数">普通函数</h4>
<p>普通函数用于封装一些复杂过程，这些函数必须要有明确的返回类型。
其中返回类型可以存在两种情况:</p>
<ol>
<li>单个返回值，箭头后面声明返回值类型。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">getFile</span><span class="p">(</span><span class="n">c</span>: <span class="nc">Class</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getRelativePath</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><ol start="2">
<li>返回集合，箭头后面的返回值类型前需要加上<code>*</code>以表明其返回的是一个集合。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">getAllFiles</span><span class="p">(</span><span class="n">db</span>: <span class="nc">JavaDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">f</span>: <span class="nc">File</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>一般情况下要求单返回值使用<code>return</code>语句，而多返回值/返回集合使用<code>yield</code>语句。
实际使用中，由于 GödelScript 底层使用 Datalog 引擎，故任何的运算都是基于集合的，单返回值实际上仅仅意味着返回的集合可能只包含一个数据，但是也可能包含多个数据。</p>
<h3 id="语句">语句</h3>
<h4 id="for-语句从集合中声明变量">for 语句：从集合中声明变量</h4>
<p>GödelScript 使用<code>for</code>关键字和类似循环语句的语法来从集合中声明变量：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="n">f</span>: <span class="nc">File</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">getAllFiles</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>其中<code>f: File</code>，冒号后面跟着的是<code>f</code>的类型，可省略。
<code>for</code>语句中允许直接定义多个变量，后面定义的变量在初始化时可使用同一语句中在它前面定义的所有变量:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlAttribute</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlAttribute</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">getAllFiles</span><span class="p">(),</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">getAllPaths</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="let-语句声明单一变量">let 语句：声明单一变量</h4>
<p>GödelScript 使用 <code>let</code>关键字来声明一个单一/中间变量：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="p">(</span><span class="n">f</span>: <span class="nc">File</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getRelativePath</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>其中<code>f: File</code>，冒号后面的类型可省略。
<code>let</code>语句中允许直接定义多个变量，后面定义的变量在初始化时可使用同一语句中在它前面定义的所有变量:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="if-语句">if 语句</h4>
<p>GödelScript 的条件语句与许多过程式程序语言类似：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;util&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;com&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>条件可以使用这些逻辑运算符进行连接：<code>!</code>取反，<code>||</code>或，<code>&amp;&amp;</code>与。</p>
<p>条件中的比较运算符：<code>&gt;</code>大于，<code>&lt;</code>小于，<code>&gt;=</code>大于等于，<code>&lt;=</code>小于等于，<code>=</code>等于或者赋值，<code>!=</code>不等于。</p>
<p>常规算术运算可以使用如下运算符：<code>+</code>加法，<code>-</code>减法/取负，<code>*</code>乘法，<code>/</code>除法。</p>
<h5 id="赋值和判等运算符">赋值和判等运算符<code>=</code></h5>
<p><code>=</code>符号在 GödelScript 中具有两种不同的语义：赋值和判等，具体的语义需要分情况进行讨论:</p>
<ol>
<li>
<p>赋值</p>
<p>赋值一般出现在<code>int</code> <code>string</code>这类基础类型的变量参数上，这类变量作为函数的参数出现时，一般被认为是未赋值的。而具有这类变量的函数被调用时，传入的参数，实际上是作为筛选条件存在。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">a</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 这里比较反直觉，在过程式语言中，这里通常会被认为是判断 a == 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// 但是在 datalog 方言中，datalog 的每个函数实际上都是在算一个中间表 (view)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// 所以这个函数本质上是生成了一个 view，数据为 [{&#34;a&#34;: 1}]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1">// assign a = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">test</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 这里看似是在通过传参让 a = 2，实际上并不是
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// example() 自己会返回 view: [{&#34;a&#34;: 1}]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// 然后通过 a = 2 来约束结果，可以看到，我们这里没有拿到任何结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// 所以返回了 false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">example</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>判等</p>
<p>对于 schema 类型来说，任何一个 schema 背后都有一个全集，所以参数列表中的 schema 类型一般被认为是已经被赋值的。对于已经赋值的变量来说，<code>=</code>就是判等操作。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// 声明 schema
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">schema</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 实现 schema 的成员函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 这里定义了 schema A 的全集
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">a</span>: <span class="nc">A</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">A</span>::<span class="n">__all__</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>同样，对于中间声明的有初始值的<code>int</code>或者<code>string</code>，<code>=</code>也是判等操作。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// assign a = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// compare a = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<h4 id="match-语句">match 语句</h4>
<p>GödelScript 允许对<code>int</code>和<code>string</code>类型编写 match 语句，match 语句是类似 switch 的多条件分支语句，match 的条件必须为字面量:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">match</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="返回语句">返回语句</h4>
<p>GödelScript 使用<code>return</code>和<code>yield</code>。<code>return</code>用于单个返回值的函数，<code>yield</code>用于集合的返回。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">a</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">b</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">yield</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">yield</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">yield</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="schema">Schema</h3>
<p>Schema 是 GödelScript 中的复杂数据表的结构。</p>
<h4 id="结构声明">结构声明</h4>
<p>GödelScript 使用<code>schema</code>关键字来声明一个表结构:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>如果某个字段在数据库中是作为主键存在的，可以使用<code>@primary</code>注解来表明其为主键:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">primary</span><span class="w"> </span><span class="n">id</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>有主键的表结构会使得查询速度得到显著提升，所以尽量绑定一个主键，主键应尽量为</strong><code>**int**</code><strong>类型。</strong></p>
<h4 id="方法实现">方法实现</h4>
<p>GödelScript 使用如下方式来声明和实现<code>schema</code>的相关方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 静态方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">f1</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 成员方法，第一个参数必须为 self
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">f2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h5 id="静态方法">静态方法</h5>
<p>静态方法不需要<code>self</code>作为第一个参数，使用方式很简单，<code>类名::方法名(...)</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getSchemaName</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;File&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="n">t</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">getSchemaName</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h5 id="成员方法">成员方法</h5>
<p>成员方法的第一个参数必须为<code>self</code>，该参数无需写明类型。这类函数的调用方式是<code>实例名.函数名(...)</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="n">path</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_java_src.db&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">File</span>::<span class="n">__all__</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getName</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h5 id="数据加载方法-fn-__all__db">数据加载方法 <code>fn __all__(db)</code></h5>
<p><code>schema</code>可以包含一个特别的<strong>静态方法</strong>，用于加载它在数据库中的数据集。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">JavaDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>这种方法必须包含特殊注解<code>@data_constraint</code>，表明该方法专用于加载，如果不写该注解，则该方法的返回为<strong>空集合</strong>。该方法返回类型必须为其本身的集合。</p>
<p>包含了该方法的<code>schema</code>可以使用一个语法糖来获取其全集：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">out</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;...&#34;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 等价于
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">File</span>::<span class="n">__all__</span><span class="p">(</span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;...&#34;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h5 id="自定义全集方法">自定义全集方法</h5>
<p><code>schema</code>允许使用不同于<code>__all__</code>名称的<strong>静态方法</strong>来表明一些集合也存在于该类型的全集中。该方法也必须包含特殊注解<code>@data_constraint</code>。该方法一般用于手动添加一些数据到该类型的全集中。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">extend_example</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kr">yield</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="mi">1234567</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="构造匿名实例">构造匿名实例</h4>
<p>GödelScript 允许用一个特定语法生成匿名实例。生成匿名实例的前提是该实例存在于该<code>schema</code>的全集中，除非该用法出现在<code>@data_constraint</code>方法中，否则结果为空。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">primary</span><span class="w"> </span><span class="n">id</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>对应的应该使用如下语法来进行匿名实例的生成:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="s">&#34;first&#34;</span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="schema-继承">Schema 继承</h4>
<p>GödelScript 中，<code>schema</code>继承非常便捷，使用样例如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">MyFile</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span></code></pre></div><h5 id="父类-field-继承">父类 Field 继承</h5>
<p>子类会默认将父类的所有 field 继承下来。所以无需手动重写。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">primary</span><span class="w"> </span><span class="n">id</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">MyFile</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span></code></pre></div><h5 id="父类-method-继承">父类 Method 继承</h5>
<p>子类会默认继承父类的所有 method，除了标注<code>@data_constraint</code>的方法。所以无需手动重写。但是需要注意的是，<code>__all__</code>方法较为特殊，不会被继承，所以需要重新编写<code>__all__</code>方法确定继承后的 schema 的全集。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">primary</span><span class="w"> </span><span class="n">id</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getId</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="o">..</span><span class="p">.}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">staticMethod</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="s">&#34;File&#34;</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">MyFile</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span></code></pre></div><h5 id="method-override">Method Override</h5>
<p>如果子类的实现中存在与父类同名的方法，则父类的方法会被子类方法<strong>覆盖</strong>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">primary</span><span class="w"> </span><span class="n">id</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">staticMethod</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="s">&#34;File&#34;</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">MyFile</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">MyFile</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">staticMethod</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="s">&#34;MyFile&#34;</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>此时<code>File::staticMethod</code>被<code>MyFile::staticMethod</code>覆盖，所以调用子类的该方法时，获取的结果为<code>&quot;MyFile&quot;</code>。</p>
<h3 id="数据库">数据库</h3>
<h4 id="数据库声明">数据库声明</h4>
<p>数据库的声明格式如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">database</span><span class="w"> </span><span class="n">DatabaseName</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// table_name 对应的是 db 中真实的表名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// GodelSchemaType 对应的是将表数据读入 godel 后，存储的对应的 schema
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">table_name</span><span class="w"> </span>: <span class="o">*</span><span class="n">GodelSchemaType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>冒号前是加载的数据库中的<strong>真实表名</strong>，冒号后是其对应的<strong>数据表格式</strong>，必须为<code>schema</code>类型。
例如 db 中存在一张表，名字为<code>annotation</code>，对应的<code>schema</code>是<code>Annotation</code>，写法为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">database</span><span class="w"> </span><span class="n">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 从 db 的 annotation 表中读取数据，存入 Annotation 中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">annotation</span><span class="w"> </span>: <span class="o">*</span><span class="n">Annotation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>另外需要保证<code>Annotation</code>结构必须和表结构一致，例如:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">Annotation</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">primary</span><span class="w"> </span><span class="n">id</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="c1">// primary注解表示该字段为主键，一个表也可以没有主键
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">content</span>: <span class="nc">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>就必须要求<code>annotation</code>表中必须有<code>id</code>和<code>content</code>字段，并且存储类型必须对应。</p>
<h4 id="数据库加载">数据库加载</h4>
<p>数据库类型拥有静态方法<code>(database)::load(filename: string)</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">loadDatabaseExample</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// load 中传入的 string 为 db 的文件名，而不需要路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// 因为 db 的路径会在执行 godel 时，通过命令行参数传入
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span>: <span class="nc">JavaDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;...&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="数据表获取">数据表获取</h4>
<p>上文中的例子中，要拿到<code>annotation</code>表，可以这样做：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">getAnnotation</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Annotation</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// load 中传入的 string 为 db 的文件名，而不需要路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">// 因为 db 的路径会在执行 godel 时，通过命令行参数传入
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span>: <span class="nc">JavaDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;...&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 直接使用 db.field 就可以拿到表数据了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">anno</span>: <span class="nc">Annotation</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">annotation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="trait">Trait</h3>
<h4 id="trait-声明">Trait 声明</h4>
<p><code>trait</code>声明语法如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">trait</span><span class="w"> </span><span class="n">Example</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getId</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getValueByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="impl-trait">Impl Trait</h4>
<p>写法与<code>impl</code>类似，但是必须要将<code>trait</code>中声明的所有函数都实现出来，否则无法通过编译。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">Example</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">XmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getId</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">id</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getValueByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">attr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlAttribute</span><span class="p">(</span><span class="n">XmlDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;...&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attr</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">attr</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">().</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">attr</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="import">Import</h3>
<p>GödelScript 使用<code>use</code>关键字来引入其他文件的符号:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="o">*</span><span class="w"> </span><span class="c1">// 引用全部符号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">xml</span>::<span class="n">Location</span><span class="w"> </span><span class="c1">// 引用单个符号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">xml</span>::<span class="p">{</span><span class="n">XmlDB</span><span class="p">,</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">}</span><span class="w"> </span><span class="c1">// 引用多个符号
</span></span></span></code></pre></div><h4 id="模块引用规则">模块引用规则</h4>
<p>GödelScript 包管理器会在传入参数中含有<code>-p {package dir path}</code>时启用。</p>
<p>包管理器会对文件夹结构进行解析，遍历其中所有的<code>.gdl</code>后缀文件。在拿到文件的相对路径后，会将路径映射到对应的包路径。如果文件的相对路径中存在<code>-</code>，或者路径中存在一个文件夹名或者文件名或者<code>.</code>后跟随的第一个字符是数字， 则该路径不会被包管理器接受，但是包管理器不会对其进行报错，只进行忽略处理。</p>
<p>如果想知道忽略了哪些路径，可以使用<code>-v</code>参数，包管理器在有该参数的情况下会将忽略的路径作为<code>warning</code>报出。如果最终映射的路径中，存在路径冲突的情况，那么包管理器会将其作为<code>error</code>报出并退出编译进程。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">packages</span>:
</span></span><span class="line"><span class="cl">  <span class="nc">coref</span>::<span class="n">cfamily</span><span class="w">    </span>-&gt; <span class="o">/..</span><span class="p">.</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">coref</span><span class="p">.</span><span class="n">cfamily</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">coref</span>::<span class="n">go</span><span class="w">         </span>-&gt; <span class="o">/..</span><span class="p">.</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">coref</span><span class="p">.</span><span class="n">go</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">coref</span>::<span class="n">java</span><span class="w">       </span>-&gt; <span class="o">/..</span><span class="p">.</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">coref</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">coref</span>::<span class="n">javascript</span><span class="w"> </span>-&gt; <span class="o">/..</span><span class="p">.</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">coref</span><span class="p">.</span><span class="n">javascript</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">coref</span>::<span class="n">properties</span><span class="w"> </span>-&gt; <span class="o">/..</span><span class="p">.</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">coref</span><span class="p">.</span><span class="n">properties</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">coref</span>::<span class="n">python</span><span class="w">     </span>-&gt; <span class="o">/..</span><span class="p">.</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">coref</span><span class="p">.</span><span class="n">python</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">coref</span>::<span class="n">sql</span><span class="w">        </span>-&gt; <span class="o">/..</span><span class="p">.</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">coref</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">coref</span>::<span class="n">xml</span><span class="w">        </span>-&gt; <span class="o">/..</span><span class="p">.</span><span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">coref</span><span class="p">.</span><span class="n">xml</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">modules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">+--</span><span class="n">coref</span><span class="w"> </span>-&gt; <span class="nc">coref</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">|--</span><span class="n">xml</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">xml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">|--</span><span class="n">properties</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">properties</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">|--</span><span class="n">cfamily</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">cfamily</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">|--</span><span class="n">java</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">|--</span><span class="n">javascript</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">javascript</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">|--</span><span class="n">go</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">|--</span><span class="n">sql</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">sql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="o">+--</span><span class="n">python</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">python</span><span class="w">
</span></span></span></code></pre></div><h4 id="路径映射样例">路径映射样例</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">Library</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|--</span><span class="w"> </span><span class="n">coref</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|--</span><span class="w"> </span><span class="n">coref</span><span class="p">.</span><span class="n">xml</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--</span><span class="w"> </span><span class="n">coref</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">|--</span><span class="w"> </span><span class="n">go</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">+--</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">+--</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">=&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">coref</span>::<span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">coref</span>::<span class="n">xml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">coref</span>::<span class="n">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">coref</span>::<span class="n">a</span>::<span class="n">b</span><span class="w">
</span></span></span></code></pre></div><p>该样例中，路径出现冲突</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">Library</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|--</span><span class="w"> </span><span class="n">coref</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">   </span><span class="o">|--</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">   </span><span class="o">+--</span><span class="w"> </span><span class="n">python</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--</span><span class="w"> </span><span class="n">coref</span><span class="p">.</span><span class="n">python</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">=&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">coref</span>::<span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">coref</span>::<span class="n">python</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="err">\</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="o">&gt;</span><span class="w"> </span><span class="err">出现冲突</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">coref</span>::<span class="n">python</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">/</span><span class="w">
</span></span></span></code></pre></div><p>该样例中，路径存在不合法字符</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">Library</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|--</span><span class="w"> </span><span class="mf">0123.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|--</span><span class="w"> </span><span class="n">my</span><span class="o">-</span><span class="n">godel</span><span class="o">-</span><span class="n">lib</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w">   </span><span class="o">+--</span><span class="w"> </span><span class="n">js</span><span class="p">.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--</span><span class="w"> </span><span class="n">lib</span><span class="o">-</span><span class="n">file</span><span class="p">.</span><span class="mf">123.</span><span class="n">gdl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">=&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">0123</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">^</span><span class="w"> </span><span class="err">第一个字符为数字</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">my</span><span class="o">-</span><span class="n">godel</span><span class="o">-</span><span class="n">lib</span>::<span class="n">js</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">^</span><span class="w">     </span><span class="o">^</span><span class="w"> </span><span class="err">使用了</span><span class="w"> </span><span class="err">`</span><span class="o">-</span><span class="err">`</span><span class="w"> </span><span class="err">字符</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lib</span><span class="o">-</span><span class="n">file</span>::<span class="mi">123</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">^</span><span class="w">      </span><span class="o">^</span><span class="w"> </span><span class="err">使用了一个字符为数字，并且路径中包含</span><span class="w"> </span><span class="err">`</span><span class="o">-</span><span class="err">`</span><span class="w">
</span></span></span></code></pre></div><h4 id="符号冲突">符号冲突</h4>
<p>在使用过程中，难免会遇到如下的情况。此时直接使用<code>File</code>会被告知符号冲突，需要指定其中一个符号。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">Location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">xml</span>::<span class="n">Location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">MyLoc</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="o">^^^^^^^^</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Error</span>: <span class="s">&#34;Location&#34;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">ambiguous</span><span class="p">,</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">symbols</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="s">&#34;coref::java::Location, coref::xml::Location&#34;</span><span class="p">.</span><span class="w">
</span></span></span></code></pre></div><p>与其他语言类似，GödelScript允许通过完整路径的方式直接指定一个符号，但是该符号必须被引入。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">Location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">xml</span>::<span class="n">Location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">MyLoc</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">coref</span>::<span class="n">xml</span>::<span class="n">Location</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span></code></pre></div><p>完整路径符号可以被用于以下情况:</p>
<ul>
<li>schema 继承</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">schema</span><span class="w"> </span><span class="n">JavaLocation</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">Location</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>函数参数和返回值</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">return_java_file</span><span class="p">(</span><span class="n">f</span>: <span class="nc">coref</span>::<span class="n">java</span>::<span class="n">File</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">coref</span>::<span class="n">java</span>::<span class="n">File</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>database 声明</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">database</span><span class="w"> </span><span class="n">MyDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">java_file</span>: <span class="nc">coref</span>::<span class="n">java</span>::<span class="n">File</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">xml_file</span>: <span class="nc">coref</span>::<span class="n">xml</span>::<span class="n">File</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">java_loc</span>: <span class="nc">coref</span>::<span class="n">java</span>::<span class="n">Location</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">xml_loc</span>: <span class="nc">coref</span>::<span class="n">xml</span>::<span class="n">Location</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>query 列表类型声明</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">query</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">Location</span><span class="w"> </span><span class="n">loc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">Location</span><span class="p">(</span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;...&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>schema 静态方法调用</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="n">loc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">Location</span><span class="p">(</span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;...&#34;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">stmt</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">ElementParent</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">stmt</span><span class="p">.</span><span class="n">is</span><span class="o">&lt;</span><span class="n">coref</span>::<span class="n">java</span>::<span class="n">ElementParent</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></div><h3 id="query">Query</h3>
<p>Query 用于进行一些简单的查询，编写的 query 一定会被输出，即使没有声明<code>main</code>函数。Query 的语法格式如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">query</span><span class="w"> </span><span class="err">名字</span><span class="w"> </span><span class="n">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">变量名</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">初始值</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">变量名</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">初始值</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">变量名</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">初始值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">条件</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">select</span><span class="w"> </span><span class="err">值</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">输出的列名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">值</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">输出的列名</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">值</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">输出的列名</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">值</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">输出的列名</span><span class="w">
</span></span></span></code></pre></div><p>from 列表中的变量声明无需加上类型标注，编译器会进行自动推导，另外此处初始化不会使用<code>=</code>号，而是<code>in</code>关键字。此外，select 列表中，输出的列名不能和参与计算的变量名冲突，但是列名可以被省略。被省略的列名会在输出结果时采取随机名字，所以尽量不要省略。</p>
<p>下面是用 query 语法编写的<code>hello world</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">query</span><span class="w"> </span><span class="n">hello_world</span><span class="w"> </span><span class="n">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">info</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s">&#34;hello world&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">select</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">greeting</span><span class="w">
</span></span></span></code></pre></div><p>上面的代码等价于如下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">greeting</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;hello world&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">hello_world</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="样例和组成结构">样例和组成结构</h4>
<p>Query 包含了查询名称，<code>from</code>列表，<code>where</code>筛选条件，<code>select</code>列表。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="p">{</span><span class="n">Callable</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="n">Interface</span><span class="p">,</span><span class="w"> </span><span class="n">JavaDB</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_java_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">query</span><span class="w"> </span><span class="n">class_method</span><span class="w"> </span><span class="n">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Callable</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Callable</span><span class="p">(</span><span class="n">db</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Class</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getBelongedClass</span><span class="p">().</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">className</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">methodName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">getSignature</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">methodSignature</span><span class="w">
</span></span></span></code></pre></div><h4 id="等价代码">等价代码</h4>
<p>上面的例子等价于如下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="p">{</span><span class="n">Callable</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="n">Interface</span><span class="p">,</span><span class="w"> </span><span class="n">JavaDB</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_java_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">output</span><span class="p">(</span><span class="n">class_method</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">class_method</span><span class="p">(</span><span class="n">className</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">methodName</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">methodSignature</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Callable</span><span class="p">(</span><span class="n">db</span><span class="p">()),</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getBelongedClass</span><span class="p">().</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">methodName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">methodSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getSignature</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="ungrounded-error-未赋值未绑定错误">Ungrounded Error: 未赋值/未绑定错误</h3>
<p>GödelScript 会将未与数据绑定的符号判定为<code>ungrounded(未赋值/未绑定)</code>。基本判定规则为:</p>
<ul>
<li>未初始化的/未被使用的/未与集合绑定的符号
<ul>
<li>未被绑定的<code>int</code> <code>string</code>参数</li>
<li>未被使用的 database 类型的参数</li>
<li>函数体有语句，但是没有任何返回语句</li>
</ul>
</li>
<li>在取非运算块中进行绑定的符号
<ul>
<li>例如 <code>!(__tmp = 1)</code>，<code>__tmp</code>会被认为是未绑定的</li>
<li>在取非运算块中调用 inline 函数或数据构造函数</li>
</ul>
</li>
</ul>
<h4 id="1-未使用的-database基础类型参数">1. 未使用的 database/基础类型参数</h4>
<p>函数代码块中，如果有一个语句分支没有使用参数中的<code>database</code>或者基础类型参数，则一定会导致<code>ungrounded</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">test</span><span class="p">(</span><span class="n">db</span>: <span class="nc">JavaDB</span><span class="p">,</span><span class="w"> </span><span class="n">a</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">^^</span><span class="w">          </span><span class="o">^</span><span class="w">       </span><span class="o">^</span><span class="w">                  </span><span class="o">^^</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Error</span>: <span class="nc">ungrounded</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="s">&#34;db, a, b&#34;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">branch</span><span class="p">.</span><span class="w">
</span></span></span></code></pre></div><p>编译器会提示在哪一条执行分支中存在 unused paramemter，根据提示检查对应的执行路径，补全对 parameter 的约束即可。</p>
<p>存在某些函数，在调用的时候，参数虽然是基础类型，但是传入的都是字面量，那这时如果错误地报出了<code>ungrounded</code>，可以给该函数添加<code>@inline</code>注解，来避免错误的约束检测。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="no">XXX</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">inline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">getValueByAttributeNameByDefaultValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">attributeName</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">hasAttribute</span><span class="p">(</span><span class="n">attributeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">getValueByAttributeName</span><span class="p">(</span><span class="n">attributeName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="bp">self</span><span class="p">.</span><span class="n">hasAttribute</span><span class="p">(</span><span class="n">attributeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;null&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">xxx</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">xx</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">getValueByAttributeNameByDefaultValue</span><span class="p">(</span><span class="s">&#34;pattern&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                               </span><span class="o">^^^^^^^^^</span><span class="w"> </span><span class="err">使用了字面量</span><span class="p">,</span><span class="w"> </span><span class="err">添加</span><span class="o">@</span><span class="n">inline来通过检测</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="2-函数体有语句的情况下无返回语句">2. 函数体有语句的情况下无返回语句</h4>
<p>GödelScript 允许一个函数体不包含任何语句，即空函数体。但是如果函数体中有其他语句，则 GödelScript 会要求必须有至少一个返回语句，否则就会出现 ungrounded error。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">test</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="o">^^</span><span class="w"> </span><span class="err">没有语句，可以通过编译</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">test</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">^^^^^^^^^^^^^^</span><span class="w"> </span><span class="err">有语句的情况下，没有返回语句，</span><span class="n">ungrounded</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="3-取非运算块中使用-inline-函数或数据构造函数">3. 取非运算块中使用 inline 函数或数据构造函数</h4>
<p>上文提到了可以通过<code>@inline</code>注解来规避 ungrounded error。但是如果在取非运算中使用了含有该注解的函数，则必然会导致 ungrounded error。</p>
<p>同样，数据构造函数实际的作用就是对一个临时中间变量进行绑定，但是这会直接导致 ungrounded error。
所以综上所述，在取非运算块中使用 inline 函数或者数据构造函数，必然会导致 ungrounded error，编译器会对所有类似的情况直接报错。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">ElementParent</span><span class="o">&gt;</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">ungrounded</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">ElementParent</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="mi">0</span><span class="p">}))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="o">^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">ungrounded</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="n">inline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">for_test</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">ElementParent</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">for_test</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="o">^^^^^^^^^^</span><span class="w"> </span><span class="err">取非运算中存在</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="err">函数，</span><span class="n">ungrounded</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="4-对链式调用的取非运算">4. 对链式调用的取非运算</h4>
<p>GödelScript 未对该情况执行<code>ungrounded</code>检测，但是该写法会导致在 Soufflé 中报<code>ungrounded</code>错误:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_java_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_java_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">get_field</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">Field</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">field</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Field</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">field</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">().</span><span class="n">getRelativePath</span><span class="p">().</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;/test/&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kr">yield</span><span class="w"> </span><span class="n">field</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>其中:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="o">!</span><span class="n">field</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">().</span><span class="n">getRelativePath</span><span class="p">().</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;/test/&#34;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>实际会被翻译为类似如下的 Soufflé 代码片段:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="o">!</span><span class="p">(</span><span class="n">__tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">field</span><span class="p">,</span><span class="w"> </span><span class="n">Field_getLocation</span><span class="p">(</span><span class="n">__tmp</span><span class="p">,</span><span class="w"> </span><span class="n">__tmp_1</span><span class="p">),</span><span class="w"> </span><span class="o">..</span><span class="p">.,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;/test/&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">__tmp_4</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">^^^^^</span><span class="w">                                   </span><span class="o">^^^^^^^</span><span class="w">
</span></span></span></code></pre></div><p>其中用于中间存储的变量在<code>!(...)</code>中被绑定，但是由于取非操作符，这个绑定被认为是假设的，但是<code>__tmp</code>,<code>__tmp_1</code>却被认为是被声明出来整个语句范围内可见的变量，从而导致<code>ungrounded</code>。</p>
<p>可以采取声明中间变量接住中间结果的方式来避免取非运算中的绑定操作:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">get_field</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">Field</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">field</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Field</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">().</span><span class="n">getRelativePath</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">path</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;/test/&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">field</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="查询示例">查询示例</h2>
<h3 id="java">Java</h3>
<h4 id="未使用方法">未使用方法</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_java_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_java_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// find unused methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">unused_method</span><span class="p">(</span><span class="n">unused</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Callable</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()),</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Callable</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()),</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="n">getCaller</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">unused</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="n">getSignature</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">unused_method</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="类继承关系">类继承关系</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_java_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_java_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Find all class and the inheritances
</span></span></span><span class="line"><span class="cl"><span class="sd"> * including parent class inheritance and ancestor class inheritance
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">class_hierarchy</span><span class="p">(</span><span class="n">className</span><span class="w"> </span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">superClassName</span><span class="w"> </span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()),</span><span class="w"> </span><span class="n">ancestor</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getAnAncestorClass</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">superClassName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ancestor</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">class_hierarchy</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="类的所有方法信息">类的所有方法信息</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">java</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_java_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavaDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavaDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_java_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Find all methods of the class
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">methods</span><span class="p">(</span><span class="n">className</span><span class="w"> </span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">methodName</span><span class="w"> </span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getAllMethods</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">methodName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getName</span><span class="p">()){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">methods</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="python">Python</h3>
<h4 id="获取函数圈复杂度">获取函数圈复杂度</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">python</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">PythonDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">PythonDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_python_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Get cyclomatic complexity of functions
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param name   function name
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param value  cyclomatic complexity of function
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param path   path of file including this function
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param sline  function start line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param eline  function end line
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">getCyclomaticComplexity</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">value</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">path</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sline</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">eline</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// get metric function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">MetricFunction</span><span class="p">(</span><span class="n">default_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">().</span><span class="n">getRelativePath</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getCyclomaticComplexity</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getStartLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">eline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getEndLineNumber</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">getCyclomaticComplexity</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="注释率统计">注释率统计</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">python</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">CombineElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">PythonDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kr">yield</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="nc">tmp</span><span class="p">.</span><span class="n">element_oid</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Function</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kr">yield</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="nc">tmp</span><span class="p">.</span><span class="n">element_oid</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">PythonDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">PythonDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_python_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// count number of total public element
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">countTotalPublicElement</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="p">(</span><span class="n">default_db</span><span class="p">()).</span><span class="n">len</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// get public elements with Docstring comment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">withDocstringCommentElement</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_db</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">DocstringComment</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">getDocumentableElement</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// count number of public elements with Docstring comment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">countTotalPublicDocumentedElement</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">withDocstringCommentElement</span><span class="p">().</span><span class="n">len</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">withPublicDocumentedBelowElement</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_db</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Comment</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">getDocumentedClassOrFunctionElement</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// count number of public element with single line comment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">countTotalPublicDocumentedBelowElement</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">withPublicDocumentedBelowElement</span><span class="p">().</span><span class="n">len</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// calculate documented percentage
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">getDocumentedPercentage</span><span class="p">(</span><span class="n">documentedPercentage</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countTotalPublicElement</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countTotalPublicDocumentedElement</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countTotalPublicDocumentedBelowElement</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">documentedPercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">documentedPercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">getDocumentedPercentage</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="函数注释情况">函数注释情况</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">python</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">CombineElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">PythonDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kr">yield</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="nc">tmp</span><span class="p">.</span><span class="n">element_oid</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Function</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kr">yield</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="w"> </span><span class="p">{</span><span class="n">id</span>: <span class="nc">tmp</span><span class="p">.</span><span class="n">element_oid</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">__all_data__</span><span class="p">).</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tmp</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">()</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Function</span><span class="p">(</span><span class="n">__all_data__</span><span class="p">).</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tmp</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">()</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">PythonDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">PythonDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_python_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">hasComment</span><span class="p">(</span><span class="n">e</span>: <span class="nc">PublicVisitedElement</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_db</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">DocstringComment</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">getDocumentableElement</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Comment</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">getDocumentedClassOrFunctionElement</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Get comment of each public element
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param type          public visited element type
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param name          public visited element name
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param filePath      file path
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param sline         element start line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param eline         element end line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param isCommented   if is commented
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">output_result</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">type</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">filePath</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sline</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">eline</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">isCommented</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">PublicVisitedElement</span><span class="p">(</span><span class="n">default_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">getType</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">().</span><span class="n">getRelativePath</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getStartLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">eline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getEndLineNumber</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hasComment</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isCommented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">hasComment</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isCommented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">output_result</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="javascript">JavaScript</h3>
<h4 id="ast-print">AST Print</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">javascript</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * print AST
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param filePath          file path
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param parentId          parent node ID
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param parentKind        parent node kind
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param parentStartLine   parent node start line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param parentEndLine     parent node end line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param childId           child node ID
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param childKind         child node kind
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param childStartLine    child node start line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param childEndLine      child node end line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param index             child node index
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">filePath</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">parentId</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">parentKind</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">parentStartLine</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">parentEndLine</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">childId</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">childKind</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">childStartLine</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">childEndLine</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">index</span>: <span class="nc">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JavascriptDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_javascript_src.db&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">parent</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">parentSyntaxKind</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">SyntaxKind</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">childSyntaxKind</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">SyntaxKind</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">parentLocation</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Location</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">childLocation</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Location</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">file</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parent</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">getParent</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">parentId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">childId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">parentSyntaxKind</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span><span class="p">.</span><span class="n">getKind</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">childSyntaxKind</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="p">.</span><span class="n">getKind</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">parentKind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentSyntaxKind</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">childKind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">childSyntaxKind</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="p">.</span><span class="n">getIndex</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">parentLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span><span class="p">.</span><span class="n">getLocation</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">childLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent</span><span class="p">.</span><span class="n">getLocation</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentLocation</span><span class="p">.</span><span class="n">getFile</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">getRelativePath</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">parentStartLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentLocation</span><span class="p">.</span><span class="n">getStartLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">parentEndLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentLocation</span><span class="p">.</span><span class="n">getEndLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">childStartLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">childLocation</span><span class="p">.</span><span class="n">getStartLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">childEndLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">childLocation</span><span class="p">.</span><span class="n">getEndLineNumber</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="圈复杂度">圈复杂度</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">javascript</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavascriptDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavascriptDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_javascript_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Output the cyclomatic complexity of each function
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param filePath      file path
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param functionName  function name
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param complexity    cyclomatic complexity
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param startLine     function start line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param endLine       function end line
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="n">filePath</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">functionName</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">complexity</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">startLine</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">endLine</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_db</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">FunctionLikeDeclaration</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">complexity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getCyclomaticComplexity</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">functionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">getRelativePath</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">startLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getStartLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">endLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getEndLineNumber</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="change-effect">Change Effect</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">javascript</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">JavascriptDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JavascriptDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_javascript_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">getACallerFunction</span><span class="p">(</span><span class="n">function</span>: <span class="nc">FunctionLikeDeclaration</span><span class="p">,</span><span class="w"> </span><span class="n">callerFunction</span>: <span class="nc">FunctionLikeDeclaration</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">mayInvokeExpression</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">MayInvokeExpression</span><span class="p">(</span><span class="n">default_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mayInvokeExpression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">getACallSite</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">callerFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mayInvokeExpression</span><span class="p">.</span><span class="n">getEnclosingFunction</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">getAnEffectedFunction</span><span class="p">(</span><span class="n">function</span>: <span class="nc">FunctionLikeDeclaration</span><span class="p">,</span><span class="w"> </span><span class="n">effectedFunction</span>: <span class="nc">FunctionLikeDeclaration</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getACallerFunction</span><span class="p">(</span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="n">effectedFunction</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">callerFunction</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">FunctionLikeDeclaration</span><span class="p">(</span><span class="n">default_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getACallerFunction</span><span class="p">(</span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="n">callerFunction</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">getAnEffectedFunction</span><span class="p">(</span><span class="n">callerFunction</span><span class="p">,</span><span class="w"> </span><span class="n">effectedFunction</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Query the effected functions according to the changed lines.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param function              the changed function id
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param signature             the changed function signature
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param functionPath          the changed function file path
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param startLine             the changed function start line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param endLine               the changed function end line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param effectedFunction      the effected function id
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param effectedSignature     the effected function signature
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param effectedFunctionPath  the effected function file path
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param effectedStartLine     the effected function start line
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param effectedEndLine       the effected function end line
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">function</span>: <span class="nc">FunctionLikeDeclaration</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">signature</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">functionPath</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">startLine</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">endLine</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">effectedFunction</span>: <span class="nc">FunctionLikeDeclaration</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">effectedSignature</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">effectedFunctionPath</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">effectedStartLine</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">effectedEndLine</span>: <span class="nc">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getAnEffectedFunction</span><span class="p">(</span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="n">effectedFunction</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">symbol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">getSymbol</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">effectedSymbol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">effectedFunction</span><span class="p">.</span><span class="n">getSymbol</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">getLocation</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">effectedLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">effectedFunction</span><span class="p">.</span><span class="n">getLocation</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">signature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">symbol</span><span class="p">.</span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">effectedSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">effectedSymbol</span><span class="p">.</span><span class="n">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">functionPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location</span><span class="p">.</span><span class="n">getRelativePath</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">startLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location</span><span class="p">.</span><span class="n">getStartLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">endLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location</span><span class="p">.</span><span class="n">getEndLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">effectedFunctionPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">effectedLocation</span><span class="p">.</span><span class="n">getRelativePath</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">effectedStartLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">effectedLocation</span><span class="p">.</span><span class="n">getStartLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">effectedEndLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">effectedLocation</span><span class="p">.</span><span class="n">getEndLineNumber</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="xml">XML</h3>
<h4 id="获取-bean">获取 bean</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">xml</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">BeanXmlElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">BeanXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">BeanXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">().</span><span class="n">getRelativePath</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">path</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;target&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;bean&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kr">yield</span><span class="w"> </span><span class="n">BeanXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">EntryXmlElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">EntryXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">EntryXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;entry&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">EntryXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">PropertyXmlElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">PropertyXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">PropertyXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;property&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">PropertyXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">XmlDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XmlDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_xml_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// get class name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">getClassName</span><span class="p">(</span><span class="n">bean</span>: <span class="nc">BeanXmlElement</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">attr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bean</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attr</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;class&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">attr</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// get key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">getKey</span><span class="p">(</span><span class="n">e</span>: <span class="nc">EntryXmlElement</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">attr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attr</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;key&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">attr</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// output value and class info of the bean
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">output1</span><span class="p">(</span><span class="n">className</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">pName</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">kName</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_db</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">bean</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">BeanXmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">PropertyXmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">EntryXmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getClassName</span><span class="p">(</span><span class="n">bean</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">bean</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">getParent</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">p</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getParent</span><span class="p">().</span><span class="n">getParent</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">pName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">kName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getKey</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">output1</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="pom">POM</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">xml</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">DependencyElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">DependencyElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">DependencyElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getElementName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;dependency&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">DependencyElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">GroupElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">GroupElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">GroupElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getElementName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;groupId&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">GroupElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">VersionElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">VersionElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">VersionElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getElementName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;version&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">VersionElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">ArtifactElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">ArtifactElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">ArtifactElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getElementName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;artifactId&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">ArtifactElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">schema</span><span class="w"> </span><span class="n">PomFile</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlFile</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">PomFile</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">PomFile</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlFile</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">getFileName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;pom.xml&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">PomFile</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">f</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">file_name</span>: <span class="nc">f</span><span class="p">.</span><span class="n">file_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">relative_path</span>: <span class="nc">f</span><span class="p">.</span><span class="n">relative_path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// output relative path of the file, referenced jar name and version
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="n">fileName</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">m3</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_xml_src.db&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">PomFile</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">GroupElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">VersionElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ArtifactElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">c1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlCharacter</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">c2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlCharacter</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">c3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlCharacter</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">p</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">DependencyElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getRelativePath</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">p</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">getParent</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">e1</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="n">getBelongedElement</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">getText</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">p</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">e2</span><span class="p">.</span><span class="n">getParent</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">e2</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">c2</span><span class="p">.</span><span class="n">getBelongedElement</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">getText</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">p</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">e3</span><span class="p">.</span><span class="n">getParent</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">e3</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">c3</span><span class="p">.</span><span class="n">getBelongedElement</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">m3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c3</span><span class="p">.</span><span class="n">getText</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="rpc">RPC</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">xml</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// select XmlElement containing &#34;mobileService&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">schema</span><span class="w"> </span><span class="n">MobileServiceXmlElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">MobileServiceXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">MobileServiceXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getElementName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;mobileService&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">MobileServiceXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">getServiceBeanValue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;serviceBean&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// select XmlElement containing &#34;sofa:extension&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">schema</span><span class="w"> </span><span class="n">SofaExtensionXmlElement</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">SofaExtensionXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">@</span><span class="n">data_constraint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">__all__</span><span class="p">(</span><span class="n">db</span>: <span class="nc">XmlDB</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">SofaExtensionXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">XmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;sofa:extension&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kr">yield</span><span class="w"> </span><span class="n">SofaExtensionXmlElement</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">location_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">parent_id</span>: <span class="nc">e</span><span class="p">.</span><span class="n">parent_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">index_order</span>: <span class="nc">e</span><span class="p">.</span><span class="n">index_order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="n">value</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_xml_src.db&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">MobileServiceXmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">SofaExtensionXmlElement</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">ancestor</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getAnAncestor</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">ancestor</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getServiceBeanValue</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="go">Go</h3>
<h4 id="获取所有文件的基本信息">获取所有文件的基本信息</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">go</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">GoDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GoDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_go_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param name          file name
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param funcCount     function/method quantity
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param totallines    total lines of file
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param codelines     code line of file
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param commentlines  comment line of fine
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param md5           md5 of this file
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param sha256        sha256 of this file
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">funcCount</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">totallines</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">codelines</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">commentlines</span>: <span class="nc">int</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">md5</span>: <span class="nc">string</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sha256</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">default_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">funcCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getFunctionCount</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">md5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getMd5Sum</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sha256</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getSha256Sum</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">totallines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getLineInfo</span><span class="p">().</span><span class="n">getNumberOfTotalLines</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">codelines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getLineInfo</span><span class="p">().</span><span class="n">getNumberOfCodeLines</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">commentlines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getLineInfo</span><span class="p">().</span><span class="n">getNumberOfCommentLines</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="获取函数及其关联的注释">获取函数及其关联的注释</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">go</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">GoDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GoDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_go_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Define a predicate called &#39;out&#39; with parameters fileName, funcName, funcComment, and signature
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="n">fileName</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">funcName</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">funcComment</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">signature</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Check if there exists a Function object &#39;func&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Function</span><span class="p">(</span><span class="n">default_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Get the name of the file the function belongs to and assign it to the variable &#39;fileName&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getBelongsFile</span><span class="p">().</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Get the name of the function and assign it to the variable &#39;funcName&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="n">funcName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Get the associated comment string for the function and assign it to the variable &#39;funcComment&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="n">funcComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getAssociatedCommentString</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Get the function type signature and assign it to the variable &#39;signature&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="n">signature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">getFunctionTypeSignature</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="获取函数圈复杂度-1">获取函数圈复杂度</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">coref</span>::<span class="n">go</span>::<span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">default_db</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">GoDB</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GoDB</span>::<span class="n">load</span><span class="p">(</span><span class="s">&#34;coref_go_src.db&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param name: file name
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param func: function name
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param cmplx: function cyclomatic complexity
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param sl,el,sc,ec: function location info
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">out</span><span class="p">(</span><span class="n">name</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">func</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">cmplx</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">sl</span>: <span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">el</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">GoFile</span><span class="p">(</span><span class="n">default_db</span><span class="p">()),</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Function</span><span class="p">(</span><span class="n">default_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">!</span><span class="n">f</span><span class="p">.</span><span class="n">isAutoGenereatedFile</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">f</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="n">function</span><span class="p">.</span><span class="n">getBelongsFile</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">cmplx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">getCyclomaticComplexity</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getStartLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">el</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getEndLineNumber</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="查询调试和优化技巧">查询调试和优化技巧</h2>
<p>运行 GödelScript 脚本的时候，经常会出现运行时间超长的问题，这里提供一些基本判别方法和解决方案。</p>
<h3 id="schema-传参导致笛卡尔积过大">Schema 传参导致笛卡尔积过大</h3>
<p>函数传参在没有<code>@inline</code>注解的情况下，默认是作为“限定”条件，而不是一个传入值存在。</p>
<p>例如下面的这个例子中，<code>get</code>获取到一个<code>Class</code>类型的传入参数，但是实际上最终的编译结果会类似下面的代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">check</span><span class="p">(</span><span class="n">class</span>: <span class="nc">Class</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;io&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// 实际的编译结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">check</span><span class="p">(</span><span class="n">class</span>: <span class="nc">Class</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 实际上是要先拿 Class 全集
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">__temp_class</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span>::<span class="n">__all__</span><span class="p">(</span><span class="n">__all_data__</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__temp_class</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;io&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>所以在传参中 schema 类型很多时，会出现多个 schema 全集做笛卡尔积的情况，空间和时间开销急剧增加。
解决方案也很简单，加一个<code>@inline</code>注解就可以：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="o">@</span><span class="n">inline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">check</span><span class="p">(</span><span class="n">class</span>: <span class="nc">Class</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;io&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">class</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">check</span><span class="p">(</span><span class="n">class</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// inline 注解会强行在代码生成阶段将函数内联到语句中，避免多次加载表
</span></span></span><span class="line"><span class="cl"><span class="c1">// 实际的编译结果类似于
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">class</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Class</span><span class="p">(</span><span class="n">default_java_db</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">contains</span><span class="p">(</span><span class="s">&#34;io&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="多层-for-导致笛卡尔积过大">多层 for 导致笛卡尔积过大</h3>
<p>在一些情况下不可避免的会使用非常多层数的 for 来加载多表进行联查，导致笛卡尔积严重膨胀。可以通过提前减少 (过滤) 集合大小的方式来缩减笛卡尔积结果数量，例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">getByIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Expression</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_java_db</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Expression</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Parameter</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">getIndex</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">getValueByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>这个例子中，e, p 做笛卡尔积，导致中间过程占用时间太长。
i 实际上是从 p 的一个方法中得到的集合，并且在实际使用中，这个集合非常小，远比 Parameter 全集小，所以可以把 i 集合的获取抽出来变成单独的函数，生成小集合，避免大集合之间笛卡尔积运算的同时，还保证了结果的等价:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">getAllParameterIndex</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="o">*</span><span class="n">int</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_java_db</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Parameter</span><span class="p">(</span><span class="n">db</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kr">yield</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">getIndex</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">getByIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Expression</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_java_db</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Expression</span><span class="p">(</span><span class="n">db</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">getAllParameterIndex</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">key_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">getValueByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>e, p 的笛卡尔积就变成了 e, i 的笛卡尔积，从运算的层面来看，笛卡尔积开销变小，<code>getIndex</code>操作也被提前了，而不是在做笛卡尔积之后进行，所以性能大幅度提升。</p>
<h3 id="不要滥用inline必须用inline的优化策略">不要滥用<code>@inline</code>/必须用<code>@inline</code>的优化策略</h3>
<p>inline 函数的底层机制是在<strong>调用处展开</strong>，如果该函数不存在大量的 schema 传参，并且在很多位置都被调用，inline 可能会导致<strong>编译结果膨胀且重复计算次数指数级增加</strong>，有时反而不利于减少运行时间。
如果存在必须要使用 inline 的情况 (比如规避<code>ungrounded</code>)，但是使用之后反而出现运行速度变慢的情况，可以采取将内嵌语句拆分为 predicate 的方式来避免展开导致的编译结果膨胀。</p>
<p>下面的例子中，<code>getValueByAttributeNameByDefaultValue</code>为了避免<code>attributeName</code>被识别为<code>ungrounded</code>所以标注<code>inline</code>，后续在 if 分支中添加了一个条件语句，但是导致了执行时间从 3 秒变成 35 秒：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">XmlElementBase</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">inline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">fn</span> <span class="nf">getValueByAttributeNameByDefaultValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">attributeName</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">hasAttribute</span><span class="p">(</span><span class="n">attributeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// return self.getValueByAttributeName(attributeName)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="c1">// 更改为了如下语句:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">      </span><span class="kd">let</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">getValueByAttributeName</span><span class="p">(</span><span class="n">attributeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;n/a&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&#34;n/a&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="bp">self</span><span class="p">.</span><span class="n">hasAttribute</span><span class="p">(</span><span class="n">attributeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;null&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>可以看到的是，增加了一层赋值和一层条件语句，在下文中，这个函数被调用了接近 20 次，导致了代码接近 20 次被重复展开，同时也造成了性能出现了一个数量级的差距。此时可以将更改的语句提取出来，由于提取出来的函数并没有使用复杂类型作为传参，所以不需要 inline 性能也没有损失，提取之后结果如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="w"> </span><span class="n">XmlElementBase</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">fn</span> <span class="nf">getTransValueByAttributeName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">attributeName</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">getValueByAttributeName</span><span class="p">(</span><span class="n">attributeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;n/a&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&#34;n/a&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">inline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">fn</span> <span class="nf">getValueByAttributeNameByDefaultValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">attributeName</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">hasAttribute</span><span class="p">(</span><span class="n">attributeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">getTransValueByAttributeName</span><span class="p">(</span><span class="n">attributeName</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="bp">self</span><span class="p">.</span><span class="n">hasAttribute</span><span class="p">(</span><span class="n">attributeName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;null&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>这样执行时间从 35 秒回到 3 秒，符合预期。</p>
<h2 id="在本机使用查询脚本流程">在本机使用查询脚本流程</h2>
<p>参见<a href="./3_install_and_run.md">安装、配置、运行</a></p>

      </div>
      








  
  
  
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

      
    
        

        
          
        

        
        
      


<footer id="article-footer">
  <time id="article-last-updated" datetime="2024-04-09"><i class="icon icon-calendar"></i>&nbsp;Last updated: 2024-04-09</time>

  
    <a id="article-prev-link" href="/docs/codefuse-query-quickstart-zh/"><i class="icon icon-prev icon-colored"></i> Prev</a>
  

  
    <a id="article-next-link"  href="/docs/codefuse-query-toolchain-zh/">Next <i class="icon icon-next icon-colored"></i></a>
  
</footer>
    </article>
    <aside id="toc">
  <span class="btn-close"><i class="icon icon-close"></i></span>
  <div class="sticky">
    <strong><i class="icon icon-toc"></i> On this page</strong>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#目录">目录</a></li>
    <li><a href="#gödelscript-基本概念和语法">GödelScript 基本概念和语法</a>
      <ul>
        <li><a href="#简介">简介</a></li>
        <li><a href="#基本程序构成">基本程序构成</a></li>
        <li><a href="#基础类型和编译器内建函数">基础类型和编译器内建函数</a></li>
        <li><a href="#函数">函数</a></li>
        <li><a href="#语句">语句</a></li>
        <li><a href="#schema">Schema</a></li>
        <li><a href="#数据库">数据库</a></li>
        <li><a href="#trait">Trait</a></li>
        <li><a href="#import">Import</a></li>
        <li><a href="#query">Query</a></li>
        <li><a href="#ungrounded-error-未赋值未绑定错误">Ungrounded Error: 未赋值/未绑定错误</a></li>
      </ul>
    </li>
    <li><a href="#查询示例">查询示例</a>
      <ul>
        <li><a href="#java">Java</a></li>
        <li><a href="#python">Python</a></li>
        <li><a href="#javascript">JavaScript</a></li>
        <li><a href="#xml">XML</a></li>
        <li><a href="#go">Go</a></li>
      </ul>
    </li>
    <li><a href="#查询调试和优化技巧">查询调试和优化技巧</a>
      <ul>
        <li><a href="#schema-传参导致笛卡尔积过大">Schema 传参导致笛卡尔积过大</a></li>
        <li><a href="#多层-for-导致笛卡尔积过大">多层 for 导致笛卡尔积过大</a></li>
        <li><a href="#不要滥用inline必须用inline的优化策略">不要滥用<code>@inline</code>/必须用<code>@inline</code>的优化策略</a></li>
      </ul>
    </li>
    <li><a href="#在本机使用查询脚本流程">在本机使用查询脚本流程</a></li>
  </ul>
</nav>
  </div>
</aside>
  </main>
</div>

    <footer id="site-footer">
  
  <div id="site-footer-copyright">
    <a href="https://github.com/codefuse-ai" target="_blank">
      <i class="icon icon-copyright"></i> 2023-2024 codefuse-ai
    </a>
  </div>

  
  <div id="site-footer-social">

    

    

    
    <a href="https://github.com/codefuse-ai" target="_blank" aria-label="github url">
      <i class="icon icon-github icon-colored"></i>
    </a>
    

    

  </div>

  
  <div id="site-footer-fund">

    

    

  </div>

  
  <div id="site-footer-love">
    Made with <i class="icon icon-love icon-colored"></i> &nbsp;from&nbsp;<a href="https://docura.github.io/" target="_blank">Docura</a>
  </div>
</footer>
    






<script type="text/javascript" src="/js/base.min.js"></script>




<script type="application/javascript">
    if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js?2024-04-09')
            .catch(function(err) {console.error('ServiceWorker registration failed: ', err);});
    }
</script>
  </body>
</html>